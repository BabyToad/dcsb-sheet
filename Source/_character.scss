// =============================================================================
// CHARACTER - Character sheet specific sections
// =============================================================================

@use 'tokens' as *;
@use 'mixins' as *;

.charsheet {
    // =========================================================================
    // ACTION RATINGS - Fakeradio Checkbox Pattern (Inverse Fill)
    // =========================================================================

    // Attribute blocks (vertical stack in right column)
    .attribute-block {
        margin-bottom: $spacing-sm;
        padding: $spacing-sm;
        border-left: 3px solid $zine-ink;
        background: rgba(0,0,0,0.02);

        .attribute-header-row {
            @include flex-row($spacing-sm);
            margin-bottom: $spacing-sm;

            .attr-name {
                margin: 0;
                font-size: $type-sm-plus;
                font-weight: bold;
                font-family: $font-typewriter;
                text-transform: uppercase;
                min-width: 55px;
                background: transparent;
                border: none;
                padding: 0;
                cursor: pointer;
                color: $zine-ink;
                text-align: left;
                @include transition(color);

                &:hover {
                    color: $zine-accent;
                }
            }
        }

        .attribute-xp {
            @include flex-row($spacing-xs);
            margin-bottom: $spacing-sm;

            .xp-label {
                @include uppercase-label(9px, $zine-grey, 0.5px);
                font-weight: normal;
                min-width: 20px;
            }
        }
    }

    // Attribute rating track (fakeradio inverse-fill)
    .attribute-track {
        @include flex-row(2px);
        @include fakeradio-hidden();

        .attr-dot {
            @include square-box(12px);
            border: 1px solid $zine-grey;
            border-radius: 1px;
            cursor: pointer;
            display: block;
            flex-grow: 0;
            background: $zine-grey;
            @include transition(background);
            line-height: 0;
            font-size: 0;
            padding: 0;
            margin: 0;
        }

        // Inverse fill: dots AFTER checked become empty
        @include fakeradio-inverse-fill(attr-dot);
    }

    .action-list {
        @include flex-column($spacing-xs);
    }

    // Action row (clickable name + dots)
    .action-row {
        @include flex-row($spacing-sm);

        .action-name {
            width: 75px;
            font-family: $font-typewriter;
            font-size: $type-sm;
            font-weight: normal;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: left;
            // Remove button styling
            background: transparent;
            border: none;
            padding: 0;
            margin: 0;
            cursor: pointer;
            color: $zine-ink;
            @include transition(color);

            &:hover {
                color: $zine-accent;
            }
        }

        .action-dots {
            @include flex-row(2px);
            @include fakeradio-hidden();

            .dot {
                @include square-box(16px);
                border: 2px solid $zine-ink;
                border-radius: 1px;
                display: block;
                cursor: pointer;
                @include transition();
                flex-grow: 0;
                background: $zine-ink;
                line-height: 0;
                font-size: 0;
                padding: 0;
                margin: 0;
            }

            // Inverse fill: dots AFTER checked become empty
            @include fakeradio-inverse-fill(dot);
        }
    }

    // Deep Cuts Advancement Block (replaces playbook XP)
    .advancement-block {
        margin-top: $spacing-md;
        padding: $spacing-sm;
        border: 1px dashed $zine-grey;
        background: rgba(0,0,0,0.02);

        .advancement-header {
            margin-bottom: $spacing-xs;
            display: flex;
            align-items: baseline;
            gap: $spacing-sm;

            .advancement-label {
                @include uppercase-label(10px, inherit, 0.5px);
                font-weight: bold;
            }

            .advancement-hint {
                font-size: $type-xs;
                color: $zine-grey;
                font-style: italic;
            }
        }

        .xp-triggers-list {
            margin-bottom: $spacing-sm;
            border-left: 2px solid $terminal-amber;
            padding-left: $spacing-sm;
        }

        .xp-trigger-item {
            display: flex;
            gap: $spacing-xs;
            align-items: flex-start;
            margin-bottom: 2px;
        }

        .xp-trigger-bullet {
            color: $terminal-amber;
            font-size: $type-sm;
            line-height: 1.4;
        }

        .xp-trigger-text,
        .xp-trigger-static {
            font-size: $type-sm;
            font-style: italic;
            color: $zine-grey;
            font-family: $font-typewriter;
            line-height: 1.4;
        }

        .xp-trigger-text:empty::after {
            content: 'Select a playbook...';
            color: $form-grey-light;
        }

        // 4× 6-segment advancement clocks in 2×2 grid
        .advancement-clocks {
            display: flex;
            flex-direction: column;
            gap: $spacing-xs;
            margin-bottom: $spacing-sm;
        }

        .adv-row {
            display: flex;
            gap: $spacing-md;
            justify-content: space-between;
        }

        .adv-clock {
            display: flex;
            gap: 1px;
            flex: 1;
            @include fakeradio-hidden();

            .adv-segment {
                @include square-box(12px);
                border: 1px solid $zine-ink;
                display: block;
                cursor: pointer;
                @include transition();
                // Forward fill: start filled
                background: $terminal-amber;
            }

            // Empty segments after checked value (forward fill pattern)
            .fakeradio:checked ~ .fakeradio + .adv-segment {
                background: transparent;
            }
        }

        // Advancement cost reference table
        .advancement-costs {
            font-size: $type-xs;
            color: $zine-grey;
            border-top: 1px dashed $zine-light-grey;
            padding-top: $spacing-xs;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2px $spacing-md;
        }

        .cost-row {
            display: flex;
            justify-content: space-between;
            gap: $spacing-xs;
        }

        .cost-label {
            font-family: $font-typewriter;
        }

        .cost-value {
            font-weight: bold;
            color: $terminal-amber;
        }
    }

    // =========================================================================
    // HARM SECTION
    // =========================================================================

    .harm-section {
        margin-bottom: $spacing-md;
        padding: $spacing-sm;
        border: 1px dashed $zine-grey;
        background: rgba(0,0,0,0.02);
    }

    .harm-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: $spacing-sm;
        padding-bottom: $spacing-sm;
        border-bottom: 1px solid $zine-light-grey;
    }

    .healing-gauge-group {
        display: flex;
        align-items: center;
        gap: $spacing-sm;

        .healing-label {
            @include uppercase-label(9px, $zine-grey, 0.5px);
            font-family: $font-mono;
            font-weight: normal;
            background: transparent;
            border: none;
            padding: 0;
            cursor: pointer;
            @include transition();

            &:hover {
                color: $terminal-amber;
            }
        }

        .healing-gauge {
            @include flex-row(1px, stretch);
            @include fakeradio-hidden();

            .healing-segment {
                @include square-box(12px);
                border: 1px solid $zine-ink;
                cursor: pointer;
                @include transition(background);
                // Forward fill: start filled
                background: $terminal-amber;
            }

            // Empty segments after checked value
            .fakeradio:checked ~ .fakeradio + .healing-segment {
                background: transparent;
            }
        }
    }

    .harm-track {
        .harm-level {
            display: flex;
            align-items: stretch;
            gap: $spacing-sm;
            margin-bottom: $spacing-sm;
            padding-bottom: $spacing-sm;
            border-bottom: 1px dotted $zine-light-grey;

            &:last-child {
                margin-bottom: 0;
                padding-bottom: 0;
                border-bottom: none;
            }

            .level-indicator {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 50px;

                .level-num {
                    font-size: 18px;
                    font-weight: bold;
                    line-height: 1;
                }

                .level-label {
                    font-size: 7px;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                    color: $zine-grey;
                }
            }

            &.severe .level-num {
                color: $status-danger;
            }

            &.moderate .level-num {
                color: $status-warning;
            }

            &.lesser .level-num {
                color: $zine-grey;
            }

            .harm-inputs {
                flex: 1;
                min-width: 0;  // Allow shrinking in flex context
                display: flex;
                gap: $spacing-sm;
            }

            .harm-input {
                flex: 1;
                min-width: 0;  // Allow shrinking in flex context
                font-size: $type-sm;
                font-family: $font-typewriter;
                padding: $spacing-xs $spacing-sm;
                background: $form-paper;
                border: 1px solid $zine-light-grey;
                min-height: 28px;

                &::placeholder {
                    color: $form-grey-light;
                    font-style: italic;
                    font-size: $type-xs;
                }

                &:focus {
                    outline: none;
                    border-color: $terminal-amber;
                }
            }

            // Single input for severe harm
            > .harm-input {
                flex: 1;
            }
        }
    }

    // =========================================================================
    // ARMOR ROW
    // =========================================================================

    .armor-row {
        display: flex;
        align-items: center;
        gap: $spacing-md;
        padding-top: $spacing-sm;
        border-top: 1px dashed $zine-grey;
    }

    // Armor track (inside armor-row)
    .armor-track {
        display: flex;
        gap: $spacing-md;
    }

    .armor-checkbox {
        @include flex-row($spacing-xs);
        cursor: pointer;
        font-size: $type-sm;
        text-transform: uppercase;

        .armor-box {
            @include square-box(14px);
            border: 2px solid $zine-ink;
            display: inline-block;
        }

        input[type="checkbox"] {
            @include hidden-checkbox-base();

            &:checked + .armor-box {
                @include checkbox-checked-fill($terminal-amber);
            }
        }
    }

    // =========================================================================
    // FINANCES - Coin & Stash
    // =========================================================================

    .finances-row {
        display: flex;
        gap: $spacing-md;
        padding-top: $spacing-sm;
        border-top: 1px dashed $zine-grey;
        margin-top: $spacing-sm;
        align-items: flex-start;
    }

    .coin-block {
        display: flex;
        align-items: center;
        gap: $spacing-xs;

        .coin-warning {
            font-size: $type-base;
            color: $status-warning;
            cursor: help;
        }
    }

    .coin-track {
        @include flex-row(1px, stretch);
        @include fakeradio-hidden();

        .coin-box {
            @include square-box(12px);
            border: 1px solid $zine-ink;
            cursor: pointer;
            @include transition();
            // Forward fill: start FILLED
            @include checkbox-checked-fill($terminal-amber);
        }

        // Empty boxes after checked value (forward fill pattern)
        .fakeradio:checked ~ .fakeradio + .coin-box {
            background: transparent;
        }
    }

    .stash-block {
        flex: 1;
        display: flex;
        align-items: flex-start;
        gap: $spacing-xs;

        .track-label {
            margin-bottom: 0;
        }
    }

    .stash-track {
        display: grid;
        grid-template-columns: repeat(10, 12px);
        grid-template-rows: repeat(4, 12px);
        gap: 1px;
        @include fakeradio-hidden();

        .stash-box {
            width: 12px;
            height: 12px;
            border: 1px solid $zine-ink;
            cursor: pointer;
            @include transition();
            // Forward fill: start FILLED
            @include checkbox-checked-fill($terminal-amber);
        }

        // Empty boxes after checked value (forward fill pattern)
        .fakeradio:checked ~ .fakeradio + .stash-box {
            background: transparent;
        }
    }

    .lifestyle-markers {
        display: grid;
        grid-template-rows: repeat(4, 12px);
        gap: 1px;
        align-items: center;
        font-size: 7px;
        text-transform: uppercase;
        letter-spacing: 0.3px;

        .marker {
            padding-left: $spacing-xs;
            line-height: 12px;

            &[data-tier="0"] { color: $status-danger; }
            &[data-tier="1"] { color: $status-warning; }
            &[data-tier="2"] { color: $zine-grey; }
            &[data-tier="3"] { color: $status-good; }
        }
    }

    // =========================================================================
    // EQUIPMENT
    // =========================================================================

    .load-selector {
        margin-bottom: $spacing-sm;

        .load-options {
            @include flex-row($spacing-md, stretch);
        }

        .load-option {
            @include flex-row($spacing-xs);
            cursor: pointer;
            font-size: $type-sm;

            .load-box {
                @include square-box(12px);
                border: 2px solid $zine-ink;
                border-radius: 1px;
            }

            input[type="radio"] {
                @include hidden-checkbox-base();

                &:checked + .load-box {
                    @include checkbox-checked-fill($zine-accent, $zine-accent);
                }
            }
        }
    }

    .load-tracker {
        font-size: $type-sm;
        margin-bottom: $spacing-sm;
        color: $zine-grey;

        .load-num {
            width: 25px;
            text-align: center;
            font-weight: bold;
        }
    }

    .equipment-columns {
        @include grid(1fr 1fr, $spacing-md);
    }

    // Item row with load checkboxes
    .item-row {
        display: flex;
        align-items: center;
        gap: $spacing-xs;
        font-size: $type-sm;
        padding: 2px 0;

        .item-load-boxes {
            display: flex;
            gap: 2px;

            // For standard items (input + label siblings)
            > input[type="checkbox"] {
                @include hidden-checkbox-base();

                &:checked + .load-box {
                    @include checkbox-checked-fill($terminal-amber);
                }
            }

            > .load-box {
                display: block;
                width: 12px;
                height: 12px;
                border: 1px solid $zine-ink;
                cursor: pointer;
            }

            // For playbook items (label wrapping input)
            .load-box-label {
                cursor: pointer;

                input[type="checkbox"] {
                    @include hidden-checkbox-base();

                    &:checked + .load-box {
                        @include checkbox-checked-fill($terminal-amber);
                    }
                }

                .load-box {
                    display: block;
                    width: 12px;
                    height: 12px;
                    border: 1px solid $zine-ink;
                }
            }
        }

        .item-name {
            flex: 1;
        }

        // Playbook item visibility control for load box 2
        &.playbook-item {
            // Hide the visibility control checkboxes
            .item-show-load2,
            .item-special-flag {
                @include hidden-checkbox-base();
            }

            // Hide load-2 box by default
            .load-2 {
                display: none;
            }

            // Show load-2 box when visibility checkbox is checked
            .item-show-load2:checked ~ .item-load-boxes .load-2 {
                display: block;
            }

            // Special items (free load) display in italics
            .item-special-flag:checked ~ .item-name {
                font-style: italic;
            }

            .item-special-flag:checked ~ .item-edit input {
                font-style: italic;
            }
        }
    }

    // =========================================================================
    // HACKER SPECIALTY CHIPSETS
    // Conditionally visible section for Hacker playbook only
    // =========================================================================

    .chipsets-toggle {
        @include hidden-checkbox-base();
    }

    // Hide chipsets section by default, show when toggle is checked
    .chipsets-section {
        display: none;
        margin-top: $spacing-md;
        padding-top: $spacing-sm;
        border-top: 1px dashed $zine-grey;
    }

    .chipsets-toggle:checked + .chipsets-section {
        display: block;
    }

    .chipsets-header {
        font-family: $font-mono;
        font-size: $type-sm;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin: 0 0 2px 0;
        color: $terminal-amber;
    }

    .chipsets-hint {
        display: block;
        font-size: $type-xs;
        font-style: italic;
        color: $zine-grey;
        margin-bottom: $spacing-sm;
    }

    .chipsets-list {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .chipset-item {
        display: flex;
        align-items: flex-start;
        gap: $spacing-xs;
        cursor: pointer;
        font-size: $type-sm;
        padding: 2px 0;
        font-style: italic;  // 0-load items are italicized

        input[type="checkbox"] {
            @include hidden-checkbox-base();

            &:checked + .chipset-box {
                @include checkbox-checked-fill($terminal-amber);
            }

            &:checked ~ .chipset-name {
                font-weight: bold;
            }
        }

        .chipset-box {
            @include square-box(12px);
            border: 1px solid $zine-ink;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .chipset-name {
            font-weight: normal;
            min-width: 110px;
        }

        .chipset-desc {
            color: $zine-grey;
            font-size: $type-xs;
            margin-top: 1px;
        }
    }

    // Playbook items (repeating section)
    .item-checkbox {
        display: flex;
        align-items: center;
        gap: $spacing-xs;
        cursor: pointer;
        font-size: $type-sm;
        padding: 2px 0;
        color: $form-ink;

        input[type="checkbox"] {
            @include hidden-checkbox-base();

            &:checked + .item-box {
                @include checkbox-checked-fill($terminal-amber);
            }

            &:checked ~ .item-name {
                font-weight: bold;
            }
        }

        .item-box {
            @include square-box(12px);
            border: 1px solid $zine-ink;
            flex-shrink: 0;
        }

        .item-name {
            flex: 1;
            white-space: nowrap;
        }

        .item-load-indicator {
            margin-left: auto;
            font-size: $type-xs;
            color: $zine-grey;
            min-width: 16px;
            text-align: center;
            border: 1px solid $zine-grey;
            padding: 1px 3px;
        }
    }

    // =========================================================================
    // AUGMENTS
    // =========================================================================

    .augment-maintenance {
        margin-bottom: $spacing-sm;
        padding: $spacing-sm;
        background: rgba(0,0,0,0.03);
        border-left: 3px solid $zine-accent;

        .maintenance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: $spacing-xs;
        }

        .maintenance-label {
            font-family: $font-mono;
            font-size: $type-sm-plus;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: transparent;
            border: none;
            padding: 0;
            cursor: pointer;
            @include transition();

            &:hover {
                color: $terminal-amber;
            }
        }

        .bc-owed {
            font-size: $type-base;
            font-weight: bold;
            color: $terminal-amber;

            .bc-value {
                font-size: $type-md;
            }
        }

        .maintenance-gauge {
            @include flex-row(0, stretch);
            @include fakeradio-hidden();

            // Make gauge read-only (auto-calculated)
            .maint-segment {
                pointer-events: none;
            }

            .maint-segment {
                width: 14px;
                height: 14px;
                border: 1px solid $zine-ink;
                border-left-width: 0;
                cursor: default;
                @include transition(background);
                // Forward fill: start filled
                background: $terminal-amber;

                &:first-of-type {
                    border-left-width: 1px;
                }

                // Clock boundary markers - thicker border every 4 segments
                &:nth-of-type(4n + 1) {
                    border-left: 2px solid $zine-ink;
                    margin-left: 3px;

                    &:first-of-type {
                        margin-left: 0;
                    }
                }
            }

            // Empty segments after checked value (forward fill pattern)
            .fakeradio:checked ~ .fakeradio + .maint-segment {
                background: transparent;
            }
        }
    }

    // =========================================================================
    // VICE - Indulge button styling
    // =========================================================================

    .vice-roll-btn {
        font-family: $font-mono;
        font-size: $type-sm;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
        background: $form-ink;
        color: $form-paper;
        border: none;
        padding: $spacing-xs $spacing-md;
        cursor: pointer;
        @include transition();

        &:hover {
            background: $terminal-amber;
            color: $form-ink;
        }
    }

    .vice-hint {
        font-family: $font-mono;
        font-size: $type-xs;
        color: $form-grey;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    // =========================================================================
    // FRIENDS & RIVALS - Playbook contact cards
    // =========================================================================

    .friends-intro {
        font-family: $font-mono;
        font-style: italic;
        color: $zine-grey;
        margin-bottom: $spacing-md;
        font-size: $type-sm-plus;
    }

    .friends-list {
        display: flex;
        flex-direction: column;
        gap: $spacing-sm;
    }

    .friend-card {
        position: relative;
        background: $form-paper;
        border: 1px solid $form-ink;
        border-left: 3px solid $zine-grey;
        padding: $spacing-sm $spacing-md;
        font-family: $font-mono;

        // Slight alternating rotation for rolodex feel
        &:nth-child(odd) {
            transform: rotate(-0.3deg);
        }
        &:nth-child(even) {
            transform: rotate(0.2deg);
        }

        // Relation controls at top right
        .friend-relation {
            position: absolute;
            top: $spacing-xs;
            right: $spacing-xs;
            display: flex;
            gap: 2px;

            .relation-option {
                cursor: pointer;

                input[type="radio"] {
                    @include hidden-checkbox-base();
                }

                .relation-badge {
                    @include square-box(18px);
                    border: 1px solid $zine-grey;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: $type-base;
                    background: $form-paper;
                    @include transition();
                }

                &:hover .relation-badge {
                    border-color: $form-ink;
                }
            }

            // Friend - amber accent with up arrow
            .relation-friend input:checked + .relation-badge {
                background: $terminal-amber;
                border-color: $terminal-amber;
                color: $form-ink;
            }

            // Neutral - grey (standard)
            .relation-neutral input:checked + .relation-badge {
                background: $zine-grey;
                border-color: $zine-grey;
                color: white;
            }

            // Rival - dark/ink with down arrow
            .relation-rival input:checked + .relation-badge {
                background: $form-ink;
                border-color: $form-ink;
                color: white;
            }
        }

        // Update left border color based on selection
        &:has(.relation-friend input:checked) {
            border-left-color: $terminal-amber;
        }
        &:has(.relation-rival input:checked) {
            border-left-color: $form-ink;
        }

        // Display mode content
        .friend-display {
            padding-right: 60px; // Space for relation badges

            .friend-name {
                display: block;
                font-weight: bold;
                font-size: $type-md;
                margin-bottom: 2px;

                &:empty::after {
                    content: 'Select a playbook...';
                    color: $form-grey-light;
                    font-weight: normal;
                    font-style: italic;
                }
            }

            .friend-desc {
                display: block;
                font-size: $type-sm;
                color: $zine-grey;

                &:empty {
                    display: none;
                }
            }
        }

        // Edit mode content
        .friend-edit {
            padding-right: 60px;

            .friend-name-input {
                width: 100%;
                font-weight: bold;
                font-size: $type-md;
                margin-bottom: $spacing-xs;
            }

            .friend-desc-input {
                width: 100%;
                font-size: $type-sm;
            }
        }
    }

    // =========================================================================
    // NOTES
    // =========================================================================

    .notes-area {
        width: 100%;
        min-height: 100px;
        font-family: $font-typewriter;
        font-size: $type-sm-plus;
        line-height: 1.5;
        padding: $spacing-sm;
        border: 1px dashed $zine-grey;
        background: repeating-linear-gradient(
            transparent,
            transparent 18px,
            $zine-light-grey 18px,
            $zine-light-grey 19px
        );
    }

    // =========================================================================
    // BUTTONS
    // =========================================================================

    .reset-btn {
        padding: $spacing-xs $spacing-md;
        font-family: $font-typewriter;
        font-size: $type-sm;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        background: transparent;
        border: 1px solid $status-warning;
        color: $status-warning;
        cursor: pointer;
        @include transition();

        &:hover {
            background: $status-warning;
            color: $zine-paper;
        }
    }

    .reset-hint {
        font-size: $type-xs;
        font-style: italic;
        color: $zine-grey;
    }

    .disengage-btn {
        width: 100%;
        padding: $spacing-sm;
        margin-top: $spacing-sm;
        font-family: $font-typewriter;
        font-size: $type-sm-plus;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
        background: $zine-paper;
        border: 2px solid $zine-ink;
        cursor: pointer;
        @include transition();

        &:hover {
            background: $zine-ink;
            color: $zine-paper;
        }
    }
}
