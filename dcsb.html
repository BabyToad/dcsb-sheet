<input class="tab-radio" type="radio" name="attr_sheet_tab" value="character" checked="checked" id="tab_character"/><input class="tab-radio" type="radio" name="attr_sheet_tab" value="crew" id="tab_crew"/><div class="charsheet"><div class="header"><div class="title-banner"><div class="banner-frame"><div class="banner-content"><pre class="block-letters"><span class="accent">██████╗</span>  <span class="accent">██████╗</span>   <span class="comma">░░░</span>   <span class="accent">███████╗</span> <span class="accent">██████╗</span>
<span class="accent">██╔══██╗</span><span class="accent">██╔════╝</span>   <span class="comma">░░░</span>   <span class="accent">██╔════╝</span> <span class="accent">██╔══██╗</span>
<span class="accent">██║  ██║</span><span class="accent">██║</span>       <span class="comma">─────</span>  <span class="accent">███████╗</span> <span class="accent">██████╔╝</span>
<span class="accent">██║  ██║</span><span class="accent">██║</span>        <span class="comma">░░░</span>   <span class="accent">╚════██║</span> <span class="accent">██╔══██╗</span>
<span class="accent">██████╔╝</span> <span class="accent">╚██████╗</span>  <span class="comma">░░░</span>   <span class="accent">███████║</span> <span class="accent">██████╔╝</span>
<span class="accent">╚═════╝</span>   <span class="accent">╚═════╝</span>  <span class="comma">░░░</span>   <span class="accent">╚══════╝</span> <span class="accent">╚═════╝</span></pre><div class="title-text"><span class="decoration">░▒▓█</span><span class="title">DARK CITY</span><span class="comma">,</span><span class="title">SHINING BABEL</span><span class="decoration">█▓▒░</span></div></div><div class="status-bar"><span class="system-text">> SYSTEM://BABEL/RUNNER_DOSSIER.SYS</span><span class="status">■ CONNECTED</span></div></div></div><div class="tab-nav"><label class="tab-button" for="tab_character"><span class="tab-text" data-i18n="CHARACTER">CHARACTER</span></label><label class="tab-button" for="tab_crew"><span class="tab-text" data-i18n="CREW">CREW</span></label></div><div class="roll-modifier-row"><span class="modifier-label">DICE MOD</span><div class="modifier-options"><input class="fakeradio" type="radio" name="attr_roll_modifier" value="-1" id="mod_neg1"/><label class="modifier-btn" for="mod_neg1">-1</label><input class="fakeradio" type="radio" name="attr_roll_modifier" value="0" checked="checked" id="mod_0"/><label class="modifier-btn mod-zero" for="mod_0">0</label><input class="fakeradio" type="radio" name="attr_roll_modifier" value="1" id="mod_1"/><label class="modifier-btn" for="mod_1">+1</label><input class="fakeradio" type="radio" name="attr_roll_modifier" value="2" id="mod_2"/><label class="modifier-btn" for="mod_2">+2</label><input class="fakeradio" type="radio" name="attr_roll_modifier" value="3" id="mod_3"/><label class="modifier-btn" for="mod_3">+3</label><input class="fakeradio" type="radio" name="attr_roll_modifier" value="4" id="mod_4"/><label class="modifier-btn" for="mod_4">+4</label><input class="fakeradio" type="radio" name="attr_roll_modifier" value="5" id="mod_5"/><label class="modifier-btn" for="mod_5">+5</label></div></div></div><div class="tab-content character-content"><div class="sheet-columns"><div class="left-column"><div class="section identity"><input class="section-edit-toggle" type="checkbox" name="attr_edit_identity" id="edit_identity"/><div class="section-header"><div class="section-stamp">SUBJECT IDENTIFICATION</div><div class="section-number-group"><div class="section-number">01</div><label class="section-edit-btn" for="edit_identity" title="Edit this section">✎</label></div></div><div class="display identity-display"><div class="identity-name-line"><span class="char-name" name="attr_character_name"></span><span class="alias-wrapper"><span class="quote">"</span><span class="alias-value" name="attr_alias"></span><span class="quote">"</span></span></div><span class="identity-look" name="attr_look"></span><div class="identity-classification"><span class="playbook-value" name="attr_playbook"></span><span class="sep">|</span><span class="heritage-value" name="attr_heritage"></span><span class="sep">|</span><span class="background-value" name="attr_background"></span></div><div class="identity-vice"><div class="vice-header"><span class="vice-label">VICE:</span><span class="vice-type-value" name="attr_vice_type"></span></div><div class="vice-body"><span class="vice-purveyor-value" name="attr_vice_purveyor"></span><span class="vice-details-value" name="attr_vice_details"></span></div></div></div><div class="edit identity-grid"><div class="identity-row primary"><label class="text-input"><input type="text" name="attr_character_name"/><div class="label" data-i18n="LEGAL_NAME"></div></label><label class="text-input"><input type="text" name="attr_alias"/><div class="label" data-i18n="ALIAS"></div></label></div><div class="identity-row secondary"><label class="text-input"><input type="text" name="attr_look"/><div class="label" data-i18n="PHYSICAL_DESCRIPTION"></div></label></div><div class="identity-row classification"><div class="select-field"><label><span class="field-label" data-i18n="PLAYBOOK">Playbook</span><select name="attr_playbook"><option value="">--</option><option value="face" data-i18n="FACE">Face</option><option value="fixer" data-i18n="FIXER">Fixer</option><option value="hacker" data-i18n="HACKER">Hacker</option><option value="midnighter" data-i18n="MIDNIGHTER">MidNighter</option><option value="murk" data-i18n="MURK">Murk</option><option value="street_warrior" data-i18n="STREET_WARRIOR">Street Warrior</option></select></label></div><div class="select-field"><label><span class="field-label" data-i18n="HERITAGE">Heritage</span><select name="attr_heritage"><option value="">--</option><option value="babel" data-i18n="BABEL">Babel</option><option value="sub_cities" data-i18n="SUB_CITIES">Sub Cities</option><option value="the_well" data-i18n="THE_WELL">The Well</option><option value="the_jungle" data-i18n="THE_JUNGLE">The Jungle</option><option value="the_syndicate" data-i18n="THE_SYNDICATE">The Syndicate</option><option value="labor_colonies" data-i18n="LABOR_COLONIES">Labor Colonies</option></select></label></div><div class="select-field"><label><span class="field-label" data-i18n="BACKGROUND">Background</span><select name="attr_background"><option value="">--</option><option value="entertainment" data-i18n="ENTERTAINMENT">Entertainment</option><option value="law" data-i18n="LAW">Law</option><option value="labor" data-i18n="LABOR">Labor</option><option value="corporate" data-i18n="CORPORATE">Corporate</option><option value="underworld" data-i18n="UNDERWORLD">Underworld</option><option value="fringe" data-i18n="FRINGE">Fringe</option></select></label></div></div><div class="identity-row vice-row"><div class="select-field vice-type-field"><label><span class="field-label">Vice</span><select name="attr_vice_type"><option value="">--</option><option value="Faith">Faith</option><option value="Gambling">Gambling</option><option value="Luxury">Luxury</option><option value="Obligation">Obligation</option><option value="Pleasure">Pleasure</option><option value="Stupor">Stupor</option><option value="Weird">Weird</option></select></label></div><label class="text-input"><input type="text" name="attr_vice_purveyor"/><div class="label" data-i18n="PURVEYOR"></div></label><label class="text-input"><input type="text" name="attr_vice_details"/><div class="label" data-i18n="DETAILS"></div></label></div><div class="identity-row reset-row"><button class="reset-btn" type="action" name="act_reset_to_playbook">Reset to Playbook Defaults</button><span class="reset-hint">Clears items, abilities, and actions</span></div></div><div class="vice-action"><button class="vice-roll-btn" type="action" name="act_indulge_vice">Indulge Vice</button><span class="vice-hint">Clears mental harm</span></div></div><div class="section condition"><div class="section-header"><div class="section-stamp">CONDITION REPORT</div><div class="section-number">03</div></div><div class="condition-tracks"><div class="stress-block"><div class="track-label" data-i18n="STRESS">STRESS</div><div class="stress-track"><input class="fakeradio zero" type="checkbox" name="attr_stress" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_stress" value="1" id="stress_1"/><label class="stress-box" for="stress_1"></label><input class="fakeradio" type="checkbox" name="attr_stress" value="2" id="stress_2"/><label class="stress-box" for="stress_2"></label><input class="fakeradio" type="checkbox" name="attr_stress" value="3" id="stress_3"/><label class="stress-box" for="stress_3"></label><input class="fakeradio" type="checkbox" name="attr_stress" value="4" id="stress_4"/><label class="stress-box" for="stress_4"></label><input class="fakeradio" type="checkbox" name="attr_stress" value="5" id="stress_5"/><label class="stress-box" for="stress_5"></label><input class="fakeradio" type="checkbox" name="attr_stress" value="6" id="stress_6"/><label class="stress-box" for="stress_6"></label><input class="fakeradio" type="checkbox" name="attr_stress" value="7" id="stress_7"/><label class="stress-box" for="stress_7"></label><input class="fakeradio" type="checkbox" name="attr_stress" value="8" id="stress_8"/><label class="stress-box" for="stress_8"></label><input class="fakeradio" type="checkbox" name="attr_stress" value="9" id="stress_9"/><label class="stress-box" for="stress_9"></label></div></div><div class="trauma-block"><div class="track-label" data-i18n="TRAUMA">TRAUMA</div><div class="trauma-track"><input class="fakeradio zero" type="checkbox" name="attr_trauma" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_trauma" value="1" id="trauma_1"/><label class="trauma-box" for="trauma_1"></label><input class="fakeradio" type="checkbox" name="attr_trauma" value="2" id="trauma_2"/><label class="trauma-box" for="trauma_2"></label><input class="fakeradio" type="checkbox" name="attr_trauma" value="3" id="trauma_3"/><label class="trauma-box" for="trauma_3"></label><input class="fakeradio" type="checkbox" name="attr_trauma" value="4" id="trauma_4"/><label class="trauma-box" for="trauma_4"></label></div></div></div><div class="trauma-conditions-row"><input class="trauma-conditions-input" type="text" name="attr_trauma_conditions" placeholder="Trauma conditions..."/></div><div class="harm-section"><div class="harm-header"><div class="track-label" data-i18n="HARM">HARM</div><div class="healing-clock-group"><div class="clock-circle" data-segments="4"><input type="checkbox" name="attr_healing_1" value="1" id="healing_seg_1"/><label class="clock-wedge" for="healing_seg_1" data-segment="1"></label><input type="checkbox" name="attr_healing_2" value="1" id="healing_seg_2"/><label class="clock-wedge" for="healing_seg_2" data-segment="2"></label><input type="checkbox" name="attr_healing_3" value="1" id="healing_seg_3"/><label class="clock-wedge" for="healing_seg_3" data-segment="3"></label><input type="checkbox" name="attr_healing_4" value="1" id="healing_seg_4"/><label class="clock-wedge" for="healing_seg_4" data-segment="4"></label></div><div class="healing-controls"><span class="clock-label">Healing</span><button class="healing-roll-btn" type="action" name="act_roll_healing">⚄</button></div></div></div><div class="harm-track"><div class="harm-level severe"><div class="level-indicator"><span class="level-num">3</span><span class="level-label">SEVERE</span></div><input class="harm-input" type="text" name="attr_harm_3" placeholder="Need Help"/></div><div class="harm-level moderate"><div class="level-indicator"><span class="level-num">2</span><span class="level-label">MODERATE</span></div><div class="harm-inputs"><input class="harm-input" type="text" name="attr_harm_2a" placeholder="-1d"/><input class="harm-input" type="text" name="attr_harm_2b" placeholder="-1d"/></div></div><div class="harm-level lesser"><div class="level-indicator"><span class="level-num">1</span><span class="level-label">LESSER</span></div><div class="harm-inputs"><input class="harm-input" type="text" name="attr_harm_1a" placeholder="Less Effect"/><input class="harm-input" type="text" name="attr_harm_1b" placeholder="Less Effect"/></div></div></div></div><div class="armor-row"><div class="track-label" data-i18n="ARMOR">ARMOR</div><div class="armor-track"><label class="armor-checkbox"><input type="checkbox" name="attr_armor" value="1"/><span class="armor-box"></span><span>Armor</span></label><label class="armor-checkbox"><input type="checkbox" name="attr_heavy_armor" value="1"/><span class="armor-box"></span><span>+Heavy</span></label><label class="armor-checkbox"><input type="checkbox" name="attr_special_armor" value="1"/><span class="armor-box"></span><span>Special</span></label></div></div></div><div class="section augments"><input class="section-edit-toggle" type="checkbox" name="attr_edit_augment" id="edit_augment"/><div class="section-header"><div class="section-stamp">AUGMENTATION RECORD</div><div class="section-number-group"><div class="section-number">04</div><label class="section-edit-btn" for="edit_augment" title="Edit this section">✎</label></div></div><div class="augment-capacity"><span class="capacity-label" data-i18n="CAPACITY">Capacity:</span><input class="augment-used" type="number" name="attr_augment_used" value="0" readonly="readonly"/><span>/</span><input class="augment-max" type="number" name="attr_augment_max" value="4"/><span class="capacity-hint edit">(expand via Playbook XP)</span></div><fieldset class="repeating_augments"><div class="augment-entry"><label class="augment-installed"><input class="augment-check" type="checkbox" name="attr_augment_installed" value="1"/><span class="installed-box"></span></label><div class="augment-content"><div class="display augment-display"><div class="augment-header-display"><span class="augment-tier-badge"><span>T</span><span class="augment-tier-value" name="attr_augment_tier"></span></span><span class="augment-name-display" name="attr_augment_name"></span></div><span class="augment-desc-display" name="attr_augment_desc"></span></div><div class="edit augment-edit"><div class="augment-header-edit"><div class="augment-tier-select"><select name="attr_augment_tier"><option value="2">T2</option><option value="3">T3</option><option value="4">T4</option><option value="5">T5</option></select></div><input class="augment-name" type="text" name="attr_augment_name" placeholder="Augment Name"/></div><textarea class="augment-desc" name="attr_augment_desc" placeholder="Description &amp; effects - what does this augment let you do?"></textarea></div></div></div></fieldset></div><div class="section circles"><input class="section-edit-toggle" type="checkbox" name="attr_edit_circles" id="edit_circles"/><div class="section-header"><div class="section-stamp">CIRCLES</div><div class="section-number-group"><div class="section-number">06</div><label class="section-edit-btn" for="edit_circles" title="Edit this section">✎</label></div></div><div class="circles-intro" data-i18n="CIRCLES_DESC">"I know a guy..."</div><div class="contacts-grid"><fieldset class="repeating_contacts"><div class="contact-card"><div class="contact-status"><label class="status-option status-friend" title="Friend"><input type="radio" name="attr_contact_relation" value="friend"/><span class="status-badge">✓</span></label><label class="status-option status-neutral" title="Neutral"><input type="radio" name="attr_contact_relation" value="neutral" checked="checked"/><span class="status-badge">○</span></label><label class="status-option status-rival" title="Rival"><input type="radio" name="attr_contact_relation" value="rival"/><span class="status-badge">✗</span></label></div><div class="contact-display display"><span class="contact-name" name="attr_contact_name"></span><span class="contact-desc" name="attr_contact_desc"></span></div><div class="contact-edit edit"><input class="contact-name-input" type="text" name="attr_contact_name" placeholder="Contact name"/><input class="contact-desc-input" type="text" name="attr_contact_desc" placeholder="Role / usefulness"/></div></div></fieldset></div></div></div><div class="right-column"><div class="section actions"><div class="section-header"><div class="section-stamp">CAPABILITY ASSESSMENT</div><div class="section-number">02</div></div><div class="attribute-block acuity"><div class="attribute-header-row"><button class="attr-name" type="action" name="act_roll_acuity_resist" data-i18n="ACUITY">ACUITY</button><div class="attribute-track"><input class="fakeradio zero" type="checkbox" name="attr_acuity_rating" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_acuity_rating" value="1" id="acuity_rating_1"/><label class="attr-dot" for="acuity_rating_1"></label><input class="fakeradio" type="checkbox" name="attr_acuity_rating" value="2" id="acuity_rating_2"/><label class="attr-dot" for="acuity_rating_2"></label><input class="fakeradio" type="checkbox" name="attr_acuity_rating" value="3" id="acuity_rating_3"/><label class="attr-dot" for="acuity_rating_3"></label><input class="fakeradio" type="checkbox" name="attr_acuity_rating" value="4" id="acuity_rating_4"/><label class="attr-dot" for="acuity_rating_4"></label></div></div><div class="attribute-xp"><span class="xp-label">XP</span><div class="xp-boxes"><input type="checkbox" name="attr_acuity_xp_1" value="1" id="acuity_xp_1"/><label class="xp-box" for="acuity_xp_1"></label><input type="checkbox" name="attr_acuity_xp_2" value="1" id="acuity_xp_2"/><label class="xp-box" for="acuity_xp_2"></label><input type="checkbox" name="attr_acuity_xp_3" value="1" id="acuity_xp_3"/><label class="xp-box" for="acuity_xp_3"></label><input type="checkbox" name="attr_acuity_xp_4" value="1" id="acuity_xp_4"/><label class="xp-box" for="acuity_xp_4"></label><input type="checkbox" name="attr_acuity_xp_5" value="1" id="acuity_xp_5"/><label class="xp-box" for="acuity_xp_5"></label><input type="checkbox" name="attr_acuity_xp_6" value="1" id="acuity_xp_6"/><label class="xp-box" for="acuity_xp_6"></label></div></div><div class="action-list"><div class="action-row"><button class="action-name" type="action" name="act_roll_hack" data-i18n="HACK"></button><div class="action-dots"><input class="fakeradio zero" type="checkbox" name="attr_hack" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_hack" value="1" id="hack_1"/><label class="dot" for="hack_1"></label><input class="fakeradio" type="checkbox" name="attr_hack" value="2" id="hack_2"/><label class="dot" for="hack_2"></label><input class="fakeradio" type="checkbox" name="attr_hack" value="3" id="hack_3"/><label class="dot" for="hack_3"></label><input class="fakeradio" type="checkbox" name="attr_hack" value="4" id="hack_4"/><label class="dot" for="hack_4"></label></div></div><div class="action-row"><button class="action-name" type="action" name="act_roll_recon" data-i18n="RECON"></button><div class="action-dots"><input class="fakeradio zero" type="checkbox" name="attr_recon" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_recon" value="1" id="recon_1"/><label class="dot" for="recon_1"></label><input class="fakeradio" type="checkbox" name="attr_recon" value="2" id="recon_2"/><label class="dot" for="recon_2"></label><input class="fakeradio" type="checkbox" name="attr_recon" value="3" id="recon_3"/><label class="dot" for="recon_3"></label><input class="fakeradio" type="checkbox" name="attr_recon" value="4" id="recon_4"/><label class="dot" for="recon_4"></label></div></div><div class="action-row"><button class="action-name" type="action" name="act_roll_scrutinize" data-i18n="SCRUTINIZE"></button><div class="action-dots"><input class="fakeradio zero" type="checkbox" name="attr_scrutinize" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_scrutinize" value="1" id="scrutinize_1"/><label class="dot" for="scrutinize_1"></label><input class="fakeradio" type="checkbox" name="attr_scrutinize" value="2" id="scrutinize_2"/><label class="dot" for="scrutinize_2"></label><input class="fakeradio" type="checkbox" name="attr_scrutinize" value="3" id="scrutinize_3"/><label class="dot" for="scrutinize_3"></label><input class="fakeradio" type="checkbox" name="attr_scrutinize" value="4" id="scrutinize_4"/><label class="dot" for="scrutinize_4"></label></div></div><div class="action-row"><button class="action-name" type="action" name="act_roll_tamper" data-i18n="TAMPER"></button><div class="action-dots"><input class="fakeradio zero" type="checkbox" name="attr_tamper" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_tamper" value="1" id="tamper_1"/><label class="dot" for="tamper_1"></label><input class="fakeradio" type="checkbox" name="attr_tamper" value="2" id="tamper_2"/><label class="dot" for="tamper_2"></label><input class="fakeradio" type="checkbox" name="attr_tamper" value="3" id="tamper_3"/><label class="dot" for="tamper_3"></label><input class="fakeradio" type="checkbox" name="attr_tamper" value="4" id="tamper_4"/><label class="dot" for="tamper_4"></label></div></div></div></div><div class="attribute-block grit"><div class="attribute-header-row"><button class="attr-name" type="action" name="act_roll_grit_resist" data-i18n="GRIT">GRIT</button><div class="attribute-track"><input class="fakeradio zero" type="checkbox" name="attr_grit_rating" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_grit_rating" value="1" id="grit_rating_1"/><label class="attr-dot" for="grit_rating_1"></label><input class="fakeradio" type="checkbox" name="attr_grit_rating" value="2" id="grit_rating_2"/><label class="attr-dot" for="grit_rating_2"></label><input class="fakeradio" type="checkbox" name="attr_grit_rating" value="3" id="grit_rating_3"/><label class="attr-dot" for="grit_rating_3"></label><input class="fakeradio" type="checkbox" name="attr_grit_rating" value="4" id="grit_rating_4"/><label class="attr-dot" for="grit_rating_4"></label></div></div><div class="attribute-xp"><span class="xp-label">XP</span><div class="xp-boxes"><input type="checkbox" name="attr_grit_xp_1" value="1" id="grit_xp_1"/><label class="xp-box" for="grit_xp_1"></label><input type="checkbox" name="attr_grit_xp_2" value="1" id="grit_xp_2"/><label class="xp-box" for="grit_xp_2"></label><input type="checkbox" name="attr_grit_xp_3" value="1" id="grit_xp_3"/><label class="xp-box" for="grit_xp_3"></label><input type="checkbox" name="attr_grit_xp_4" value="1" id="grit_xp_4"/><label class="xp-box" for="grit_xp_4"></label><input type="checkbox" name="attr_grit_xp_5" value="1" id="grit_xp_5"/><label class="xp-box" for="grit_xp_5"></label><input type="checkbox" name="attr_grit_xp_6" value="1" id="grit_xp_6"/><label class="xp-box" for="grit_xp_6"></label></div></div><div class="action-list"><div class="action-row"><button class="action-name" type="action" name="act_roll_brawl" data-i18n="BRAWL"></button><div class="action-dots"><input class="fakeradio zero" type="checkbox" name="attr_brawl" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_brawl" value="1" id="brawl_1"/><label class="dot" for="brawl_1"></label><input class="fakeradio" type="checkbox" name="attr_brawl" value="2" id="brawl_2"/><label class="dot" for="brawl_2"></label><input class="fakeradio" type="checkbox" name="attr_brawl" value="3" id="brawl_3"/><label class="dot" for="brawl_3"></label><input class="fakeradio" type="checkbox" name="attr_brawl" value="4" id="brawl_4"/><label class="dot" for="brawl_4"></label></div></div><div class="action-row"><button class="action-name" type="action" name="act_roll_hunt" data-i18n="HUNT"></button><div class="action-dots"><input class="fakeradio zero" type="checkbox" name="attr_hunt" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_hunt" value="1" id="hunt_1"/><label class="dot" for="hunt_1"></label><input class="fakeradio" type="checkbox" name="attr_hunt" value="2" id="hunt_2"/><label class="dot" for="hunt_2"></label><input class="fakeradio" type="checkbox" name="attr_hunt" value="3" id="hunt_3"/><label class="dot" for="hunt_3"></label><input class="fakeradio" type="checkbox" name="attr_hunt" value="4" id="hunt_4"/><label class="dot" for="hunt_4"></label></div></div><div class="action-row"><button class="action-name" type="action" name="act_roll_skulk" data-i18n="SKULK"></button><div class="action-dots"><input class="fakeradio zero" type="checkbox" name="attr_skulk" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_skulk" value="1" id="skulk_1"/><label class="dot" for="skulk_1"></label><input class="fakeradio" type="checkbox" name="attr_skulk" value="2" id="skulk_2"/><label class="dot" for="skulk_2"></label><input class="fakeradio" type="checkbox" name="attr_skulk" value="3" id="skulk_3"/><label class="dot" for="skulk_3"></label><input class="fakeradio" type="checkbox" name="attr_skulk" value="4" id="skulk_4"/><label class="dot" for="skulk_4"></label></div></div><div class="action-row"><button class="action-name" type="action" name="act_roll_vandalize" data-i18n="VANDALIZE"></button><div class="action-dots"><input class="fakeradio zero" type="checkbox" name="attr_vandalize" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_vandalize" value="1" id="vandalize_1"/><label class="dot" for="vandalize_1"></label><input class="fakeradio" type="checkbox" name="attr_vandalize" value="2" id="vandalize_2"/><label class="dot" for="vandalize_2"></label><input class="fakeradio" type="checkbox" name="attr_vandalize" value="3" id="vandalize_3"/><label class="dot" for="vandalize_3"></label><input class="fakeradio" type="checkbox" name="attr_vandalize" value="4" id="vandalize_4"/><label class="dot" for="vandalize_4"></label></div></div></div></div><div class="attribute-block resolve"><div class="attribute-header-row"><button class="attr-name" type="action" name="act_roll_resolve_resist" data-i18n="RESOLVE">RESOLVE</button><div class="attribute-track"><input class="fakeradio zero" type="checkbox" name="attr_resolve_rating" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_resolve_rating" value="1" id="resolve_rating_1"/><label class="attr-dot" for="resolve_rating_1"></label><input class="fakeradio" type="checkbox" name="attr_resolve_rating" value="2" id="resolve_rating_2"/><label class="attr-dot" for="resolve_rating_2"></label><input class="fakeradio" type="checkbox" name="attr_resolve_rating" value="3" id="resolve_rating_3"/><label class="attr-dot" for="resolve_rating_3"></label><input class="fakeradio" type="checkbox" name="attr_resolve_rating" value="4" id="resolve_rating_4"/><label class="attr-dot" for="resolve_rating_4"></label></div></div><div class="attribute-xp"><span class="xp-label">XP</span><div class="xp-boxes"><input type="checkbox" name="attr_resolve_xp_1" value="1" id="resolve_xp_1"/><label class="xp-box" for="resolve_xp_1"></label><input type="checkbox" name="attr_resolve_xp_2" value="1" id="resolve_xp_2"/><label class="xp-box" for="resolve_xp_2"></label><input type="checkbox" name="attr_resolve_xp_3" value="1" id="resolve_xp_3"/><label class="xp-box" for="resolve_xp_3"></label><input type="checkbox" name="attr_resolve_xp_4" value="1" id="resolve_xp_4"/><label class="xp-box" for="resolve_xp_4"></label><input type="checkbox" name="attr_resolve_xp_5" value="1" id="resolve_xp_5"/><label class="xp-box" for="resolve_xp_5"></label><input type="checkbox" name="attr_resolve_xp_6" value="1" id="resolve_xp_6"/><label class="xp-box" for="resolve_xp_6"></label></div></div><div class="action-list"><div class="action-row"><button class="action-name" type="action" name="act_roll_consort" data-i18n="CONSORT"></button><div class="action-dots"><input class="fakeradio zero" type="checkbox" name="attr_consort" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_consort" value="1" id="consort_1"/><label class="dot" for="consort_1"></label><input class="fakeradio" type="checkbox" name="attr_consort" value="2" id="consort_2"/><label class="dot" for="consort_2"></label><input class="fakeradio" type="checkbox" name="attr_consort" value="3" id="consort_3"/><label class="dot" for="consort_3"></label><input class="fakeradio" type="checkbox" name="attr_consort" value="4" id="consort_4"/><label class="dot" for="consort_4"></label></div></div><div class="action-row"><button class="action-name" type="action" name="act_roll_dominate" data-i18n="DOMINATE"></button><div class="action-dots"><input class="fakeradio zero" type="checkbox" name="attr_dominate" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_dominate" value="1" id="dominate_1"/><label class="dot" for="dominate_1"></label><input class="fakeradio" type="checkbox" name="attr_dominate" value="2" id="dominate_2"/><label class="dot" for="dominate_2"></label><input class="fakeradio" type="checkbox" name="attr_dominate" value="3" id="dominate_3"/><label class="dot" for="dominate_3"></label><input class="fakeradio" type="checkbox" name="attr_dominate" value="4" id="dominate_4"/><label class="dot" for="dominate_4"></label></div></div><div class="action-row"><button class="action-name" type="action" name="act_roll_finesse" data-i18n="FINESSE"></button><div class="action-dots"><input class="fakeradio zero" type="checkbox" name="attr_finesse" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_finesse" value="1" id="finesse_1"/><label class="dot" for="finesse_1"></label><input class="fakeradio" type="checkbox" name="attr_finesse" value="2" id="finesse_2"/><label class="dot" for="finesse_2"></label><input class="fakeradio" type="checkbox" name="attr_finesse" value="3" id="finesse_3"/><label class="dot" for="finesse_3"></label><input class="fakeradio" type="checkbox" name="attr_finesse" value="4" id="finesse_4"/><label class="dot" for="finesse_4"></label></div></div><div class="action-row"><button class="action-name" type="action" name="act_roll_sway" data-i18n="SWAY"></button><div class="action-dots"><input class="fakeradio zero" type="checkbox" name="attr_sway" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_sway" value="1" id="sway_1"/><label class="dot" for="sway_1"></label><input class="fakeradio" type="checkbox" name="attr_sway" value="2" id="sway_2"/><label class="dot" for="sway_2"></label><input class="fakeradio" type="checkbox" name="attr_sway" value="3" id="sway_3"/><label class="dot" for="sway_3"></label><input class="fakeradio" type="checkbox" name="attr_sway" value="4" id="sway_4"/><label class="dot" for="sway_4"></label></div></div></div></div><div class="playbook-xp-block"><div class="xp-label-row"><span class="xp-label" data-i18n="PLAYBOOK_XP">Playbook XP</span></div><div class="xp-trigger-row"><span class="xp-trigger-text" name="attr_xp_trigger"></span></div><div class="xp-boxes"><input type="checkbox" name="attr_playbook_xp_1" value="1" id="playbook_xp_1"/><label class="xp-box" for="playbook_xp_1"></label><input type="checkbox" name="attr_playbook_xp_2" value="1" id="playbook_xp_2"/><label class="xp-box" for="playbook_xp_2"></label><input type="checkbox" name="attr_playbook_xp_3" value="1" id="playbook_xp_3"/><label class="xp-box" for="playbook_xp_3"></label><input type="checkbox" name="attr_playbook_xp_4" value="1" id="playbook_xp_4"/><label class="xp-box" for="playbook_xp_4"></label><input type="checkbox" name="attr_playbook_xp_5" value="1" id="playbook_xp_5"/><label class="xp-box" for="playbook_xp_5"></label><input type="checkbox" name="attr_playbook_xp_6" value="1" id="playbook_xp_6"/><label class="xp-box" for="playbook_xp_6"></label><input type="checkbox" name="attr_playbook_xp_7" value="1" id="playbook_xp_7"/><label class="xp-box" for="playbook_xp_7"></label><input type="checkbox" name="attr_playbook_xp_8" value="1" id="playbook_xp_8"/><label class="xp-box" for="playbook_xp_8"></label></div></div></div><div class="section equipment"><input class="section-edit-toggle" type="checkbox" name="attr_edit_equipment" id="edit_equipment"/><div class="section-header"><div class="section-stamp">EQUIPMENT MANIFEST</div><div class="section-number-group"><div class="section-number">05</div><label class="section-edit-btn" for="edit_equipment" title="Edit this section">✎</label></div></div><div class="load-selector"><div class="load-label" data-i18n="LOAD">LOAD</div><div class="load-options"><label class="load-option"><input type="radio" name="attr_load" value="3"/><span class="load-box"></span><span data-i18n="LIGHT">Light (3)</span></label><label class="load-option"><input type="radio" name="attr_load" value="5" checked="checked"/><span class="load-box"></span><span data-i18n="NORMAL">Normal (5)</span></label><label class="load-option"><input type="radio" name="attr_load" value="6"/><span class="load-box"></span><span data-i18n="HEAVY">Heavy (6)</span></label></div></div><div class="load-tracker"><span class="load-current" data-i18n="CURRENT">Current:</span><input class="load-num" type="number" name="attr_load_current" value="0" readonly="readonly"/><span>/</span><input class="load-num" type="number" name="attr_load_max" value="5" readonly="readonly"/></div><div class="equipment-columns"><div class="equipment-column standard"><h4 data-i18n="STANDARD_ITEMS">Standard Items</h4><label class="item-checkbox"><input type="checkbox" name="attr_item_blade" value="1"/><span class="item-box"></span><span class="item-name">Blade or club</span><span class="item-load">1</span></label><label class="item-checkbox"><input type="checkbox" name="attr_item_pistol" value="1"/><span class="item-box"></span><span class="item-name">Pistol</span><span class="item-load">1</span></label><label class="item-checkbox"><input type="checkbox" name="attr_item_ammo" value="1"/><span class="item-box"></span><span class="item-name">Extra ammo</span><span class="item-load">1</span></label><label class="item-checkbox"><input type="checkbox" name="attr_item_armor" value="1"/><span class="item-box"></span><span class="item-name">Armor</span><span class="item-load">2</span></label><label class="item-checkbox"><input type="checkbox" name="attr_item_heavy" value="1"/><span class="item-box"></span><span class="item-name">+Heavy</span><span class="item-load">3</span></label><label class="item-checkbox"><input type="checkbox" name="attr_item_tools" value="1"/><span class="item-box"></span><span class="item-name">Burglary tools</span><span class="item-load">1</span></label><label class="item-checkbox"><input type="checkbox" name="attr_item_climbing" value="1"/><span class="item-box"></span><span class="item-name">Climbing gear</span><span class="item-load">2</span></label><label class="item-checkbox"><input type="checkbox" name="attr_item_documents" value="1"/><span class="item-box"></span><span class="item-name">Documents</span><span class="item-load">1</span></label></div><div class="equipment-column playbook"><h4 data-i18n="PLAYBOOK_ITEMS">Playbook Items</h4><fieldset class="repeating_items"><label class="item-checkbox"><input type="checkbox" name="attr_item_carried" value="1"/><span class="item-box"></span><span class="display item-name" name="attr_item_name"></span><span class="display item-load">(<span name="attr_item_load"></span>)</span><div class="edit item-edit"><input type="text" name="attr_item_name" placeholder="Item name"/><input type="number" name="attr_item_load" value="1" min="0" max="6"/></div></label></fieldset></div></div></div><div class="section notes"><input class="section-edit-toggle" type="checkbox" name="attr_edit_notes" id="edit_notes"/><div class="section-header"><div class="section-stamp">NOTES</div><div class="section-number-group"><div class="section-number">07</div><label class="section-edit-btn" for="edit_notes" title="Edit this section">✎</label></div></div><span class="display notes-display" name="attr_notes"></span><textarea class="edit notes-area" name="attr_notes" placeholder="Personal notes, background details, mission logs..."></textarea></div></div></div></div><div class="tab-content crew-content"><div class="sheet-columns"><div class="left-column"><div class="section crew-identity"><div class="section-header"><div class="section-stamp">CREW IDENTIFICATION</div><div class="section-number">01</div></div><div class="crew-id-grid"><div class="crew-primary"><label class="text-input"><input type="text" name="attr_crew_name"/><div class="label" data-i18n="CREW_NAME"></div></label></div><div class="crew-classification"><div class="select-field"><label><span class="field-label" data-i18n="CREW_TYPE">Crew Type</span><select name="attr_crew_type"><option value="">--</option><option value="firebrands" data-i18n="FIREBRANDS">Firebrands</option><option value="leeches" data-i18n="LEECHES">Leeches</option><option value="runners" data-i18n="RUNNERS">Runners</option><option value="zokus" data-i18n="ZOKUS">Zokus</option></select></label></div><div class="text-field"><label><span class="field-label" data-i18n="REPUTATION">Reputation</span><input type="text" name="attr_reputation" list="reputation_list" placeholder="Ambitious, Brutal, etc."/><datalist id="reputation_list"><option value="Ambitious"></option><option value="Brutal"></option><option value="Flashy"></option><option value="Mercenary"></option><option value="Savvy"></option><option value="Strange"></option></datalist></label></div></div><div class="crew-location"><label class="text-input"><input type="text" name="attr_hunting_grounds"/><div class="label" data-i18n="HUNTING_GROUNDS"></div></label><label class="text-input"><input type="text" name="attr_lair"/><div class="label" data-i18n="LAIR"></div></label></div></div></div><div class="section crew-stats"><div class="section-header"><div class="section-stamp">CREW STATS</div><div class="section-number">02</div></div><div class="stats-grid"><div class="stats-row tier-hold-row"><div class="tier-block"><div class="stat-label" data-i18n="TIER">TIER</div><div class="tier-selector"><input type="radio" name="attr_crew_tier" value="0" checked="checked" id="tier_0"/><label class="tier-box" for="tier_0">0</label><input type="radio" name="attr_crew_tier" value="1" id="tier_1"/><label class="tier-box" for="tier_1">1</label><input type="radio" name="attr_crew_tier" value="2" id="tier_2"/><label class="tier-box" for="tier_2">2</label><input type="radio" name="attr_crew_tier" value="3" id="tier_3"/><label class="tier-box" for="tier_3">3</label><input type="radio" name="attr_crew_tier" value="4" id="tier_4"/><label class="tier-box" for="tier_4">4</label></div></div><div class="hold-block"><div class="stat-label" data-i18n="HOLD">HOLD</div><div class="hold-selector"><input type="radio" name="attr_hold" value="weak" id="hold_weak"/><label class="hold-option" for="hold_weak" data-i18n="WEAK">Weak</label><input type="radio" name="attr_hold" value="strong" checked="checked" id="hold_strong"/><label class="hold-option" for="hold_strong" data-i18n="STRONG">Strong</label></div></div></div><div class="stats-row rep-row"><div class="rep-block"><div class="stat-label" data-i18n="REP">REP</div><div class="rep-track"><input class="fakeradio zero" type="checkbox" name="attr_rep" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_rep" value="1" id="rep_1"/><label class="rep-box" for="rep_1"></label><input class="fakeradio" type="checkbox" name="attr_rep" value="2" id="rep_2"/><label class="rep-box" for="rep_2"></label><input class="fakeradio" type="checkbox" name="attr_rep" value="3" id="rep_3"/><label class="rep-box" for="rep_3"></label><input class="fakeradio" type="checkbox" name="attr_rep" value="4" id="rep_4"/><label class="rep-box" for="rep_4"></label><input class="fakeradio" type="checkbox" name="attr_rep" value="5" id="rep_5"/><label class="rep-box" for="rep_5"></label><input class="fakeradio" type="checkbox" name="attr_rep" value="6" id="rep_6"/><label class="rep-box" for="rep_6"></label><input class="fakeradio" type="checkbox" name="attr_rep" value="7" id="rep_7"/><label class="rep-box" for="rep_7"></label><input class="fakeradio" type="checkbox" name="attr_rep" value="8" id="rep_8"/><label class="rep-box" for="rep_8"></label><input class="fakeradio" type="checkbox" name="attr_rep" value="9" id="rep_9"/><label class="rep-box" for="rep_9"></label><input class="fakeradio" type="checkbox" name="attr_rep" value="10" id="rep_10"/><label class="rep-box" for="rep_10"></label><input class="fakeradio" type="checkbox" name="attr_rep" value="11" id="rep_11"/><label class="rep-box" for="rep_11"></label><input class="fakeradio" type="checkbox" name="attr_rep" value="12" id="rep_12"/><label class="rep-box" for="rep_12"></label></div></div></div><div class="stats-row heat-wanted-row"><div class="heat-block"><div class="stat-label" data-i18n="HEAT">HEAT</div><div class="heat-track"><input class="fakeradio zero" type="checkbox" name="attr_heat" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_heat" value="1" id="heat_1"/><label class="heat-box" for="heat_1"></label><input class="fakeradio" type="checkbox" name="attr_heat" value="2" id="heat_2"/><label class="heat-box" for="heat_2"></label><input class="fakeradio" type="checkbox" name="attr_heat" value="3" id="heat_3"/><label class="heat-box" for="heat_3"></label><input class="fakeradio" type="checkbox" name="attr_heat" value="4" id="heat_4"/><label class="heat-box" for="heat_4"></label><input class="fakeradio" type="checkbox" name="attr_heat" value="5" id="heat_5"/><label class="heat-box" for="heat_5"></label><input class="fakeradio" type="checkbox" name="attr_heat" value="6" id="heat_6"/><label class="heat-box" for="heat_6"></label><input class="fakeradio" type="checkbox" name="attr_heat" value="7" id="heat_7"/><label class="heat-box" for="heat_7"></label><input class="fakeradio" type="checkbox" name="attr_heat" value="8" id="heat_8"/><label class="heat-box" for="heat_8"></label><input class="fakeradio" type="checkbox" name="attr_heat" value="9" id="heat_9"/><label class="heat-box" for="heat_9"></label></div></div><div class="wanted-block"><div class="stat-label" data-i18n="WANTED">WANTED</div><div class="wanted-track"><input class="fakeradio zero" type="checkbox" name="attr_wanted" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_wanted" value="1" id="wanted_1"/><label class="wanted-box" for="wanted_1"></label><input class="fakeradio" type="checkbox" name="attr_wanted" value="2" id="wanted_2"/><label class="wanted-box" for="wanted_2"></label><input class="fakeradio" type="checkbox" name="attr_wanted" value="3" id="wanted_3"/><label class="wanted-box" for="wanted_3"></label><input class="fakeradio" type="checkbox" name="attr_wanted" value="4" id="wanted_4"/><label class="wanted-box" for="wanted_4"></label></div></div></div><div class="stats-row vault-row"><div class="vault-block"><div class="stat-label" data-i18n="VAULT">VAULT</div><div class="vault-track"><input class="fakeradio zero" type="checkbox" name="attr_vault" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_vault" value="1" id="vault_1"/><label class="vault-box" for="vault_1"></label><input class="fakeradio" type="checkbox" name="attr_vault" value="2" id="vault_2"/><label class="vault-box" for="vault_2"></label><input class="fakeradio" type="checkbox" name="attr_vault" value="3" id="vault_3"/><label class="vault-box" for="vault_3"></label><input class="fakeradio" type="checkbox" name="attr_vault" value="4" id="vault_4"/><label class="vault-box" for="vault_4"></label><input class="fakeradio" type="checkbox" name="attr_vault" value="5" id="vault_5"/><label class="vault-box" for="vault_5"></label><input class="fakeradio" type="checkbox" name="attr_vault" value="6" id="vault_6"/><label class="vault-box" for="vault_6"></label><input class="fakeradio" type="checkbox" name="attr_vault" value="7" id="vault_7"/><label class="vault-box" for="vault_7"></label><input class="fakeradio" type="checkbox" name="attr_vault" value="8" id="vault_8"/><label class="vault-box" for="vault_8"></label><input class="fakeradio" type="checkbox" name="attr_vault" value="9" id="vault_9"/><label class="vault-box" for="vault_9"></label><input class="fakeradio" type="checkbox" name="attr_vault" value="10" id="vault_10"/><label class="vault-box" for="vault_10"></label><input class="fakeradio" type="checkbox" name="attr_vault" value="11" id="vault_11"/><label class="vault-box" for="vault_11"></label><input class="fakeradio" type="checkbox" name="attr_vault" value="12" id="vault_12"/><label class="vault-box" for="vault_12"></label><input class="fakeradio" type="checkbox" name="attr_vault" value="13" id="vault_13"/><label class="vault-box" for="vault_13"></label><input class="fakeradio" type="checkbox" name="attr_vault" value="14" id="vault_14"/><label class="vault-box" for="vault_14"></label><input class="fakeradio" type="checkbox" name="attr_vault" value="15" id="vault_15"/><label class="vault-box" for="vault_15"></label><input class="fakeradio" type="checkbox" name="attr_vault" value="16" id="vault_16"/><label class="vault-box" for="vault_16"></label></div></div></div></div></div><div class="section score-tracker"><div class="section-header"><div class="section-stamp">SCORE TRACKER</div><div class="section-number">03</div></div><div class="score-grid"><div class="heat-gauge"><div class="gauge-header"><div class="gauge-label" data-i18n="HEAT_GAUGE">HEAT GAUGE</div><div class="gauge-dice"><span class="dice-label">Disengage:</span><span class="dice-count" name="attr_score_heat_dice">8</span><span>d6</span></div></div><div class="gauge-track"><input class="fakeradio zero" type="checkbox" name="attr_score_heat" value="0" checked="checked"/><input class="fakeradio" type="checkbox" name="attr_score_heat" value="1" id="score_heat_1"/><label class="gauge-box" for="score_heat_1"></label><input class="fakeradio" type="checkbox" name="attr_score_heat" value="2" id="score_heat_2"/><label class="gauge-box" for="score_heat_2"></label><input class="fakeradio" type="checkbox" name="attr_score_heat" value="3" id="score_heat_3"/><label class="gauge-box" for="score_heat_3"></label><input class="fakeradio" type="checkbox" name="attr_score_heat" value="4" id="score_heat_4"/><label class="gauge-box" for="score_heat_4"></label><input class="fakeradio" type="checkbox" name="attr_score_heat" value="5" id="score_heat_5"/><label class="gauge-box" for="score_heat_5"></label><input class="fakeradio" type="checkbox" name="attr_score_heat" value="6" id="score_heat_6"/><label class="gauge-box" for="score_heat_6"></label><input class="fakeradio" type="checkbox" name="attr_score_heat" value="7" id="score_heat_7"/><label class="gauge-box" for="score_heat_7"></label><input class="fakeradio" type="checkbox" name="attr_score_heat" value="8" id="score_heat_8"/><label class="gauge-box" for="score_heat_8"></label></div></div><button class="disengage-btn" type="action" name="act_disengage_roll"><span data-i18n="ROLL_DISENGAGEMENT">Roll Disengagement</span></button></div></div><div class="section crew-notes"><div class="section-header"><div class="section-stamp">CREW NOTES</div><div class="section-number">04</div></div><textarea class="notes-area" name="attr_crew_notes" placeholder="Mission logs, ongoing operations, crew history..."></textarea></div></div><div class="right-column"><div class="section crew-upgrades"><div class="section-header"><div class="section-stamp">CREW UPGRADES</div><div class="section-number">05</div></div><div class="upgrades-grid"><div class="upgrade-category lair"><h4 data-i18n="LAIR">Lair</h4><div class="upgrade-list"><div class="upgrade-checkbox upgrade-multi"><input type="checkbox" name="attr_lair_rides_1" value="1" id="lair_rides_1"/><label class="upgrade-box" for="lair_rides_1"></label><input type="checkbox" name="attr_lair_rides_2" value="1" id="lair_rides_2"/><label class="upgrade-box" for="lair_rides_2"></label><span class="upgrade-name">Rides</span><span class="upgrade-cost">(2)</span></div><div class="upgrade-checkbox upgrade-multi"><input type="checkbox" name="attr_lair_specialty_1" value="1" id="lair_specialty_1"/><label class="upgrade-box" for="lair_specialty_1"></label><input type="checkbox" name="attr_lair_specialty_2" value="1" id="lair_specialty_2"/><label class="upgrade-box" for="lair_specialty_2"></label><span class="upgrade-name">Specialty Transport</span><span class="upgrade-cost">(2)</span></div><label class="upgrade-checkbox"><input type="checkbox" name="attr_lair_hidden" value="1"/><span class="upgrade-box"></span><span class="upgrade-name">Hidden</span></label><label class="upgrade-checkbox"><input type="checkbox" name="attr_lair_quarters" value="1"/><span class="upgrade-box"></span><span class="upgrade-name">Quarters</span></label><div class="upgrade-checkbox upgrade-multi"><input type="checkbox" name="attr_lair_secure_1" value="1" id="lair_secure_1"/><label class="upgrade-box" for="lair_secure_1"></label><input type="checkbox" name="attr_lair_secure_2" value="1" id="lair_secure_2"/><label class="upgrade-box" for="lair_secure_2"></label><span class="upgrade-name">Secure</span><span class="upgrade-cost">(2)</span></div><div class="upgrade-checkbox upgrade-multi"><input type="checkbox" name="attr_lair_encryption_1" value="1" id="lair_encryption_1"/><label class="upgrade-box" for="lair_encryption_1"></label><input type="checkbox" name="attr_lair_encryption_2" value="1" id="lair_encryption_2"/><label class="upgrade-box" for="lair_encryption_2"></label><span class="upgrade-name">BC Encryption</span><span class="upgrade-cost">(2)</span></div><label class="upgrade-checkbox"><input type="checkbox" name="attr_lair_workshop" value="1"/><span class="upgrade-box"></span><span class="upgrade-name">Workshop</span></label></div></div><div class="upgrade-category training"><h4 data-i18n="TRAINING">Training</h4><div class="upgrade-list"><label class="upgrade-checkbox"><input type="checkbox" name="attr_train_acuity" value="1"/><span class="upgrade-box"></span><span class="upgrade-name">Acuity</span></label><label class="upgrade-checkbox"><input type="checkbox" name="attr_train_grit" value="1"/><span class="upgrade-box"></span><span class="upgrade-name">Grit</span></label><label class="upgrade-checkbox"><input type="checkbox" name="attr_train_resolve" value="1"/><span class="upgrade-box"></span><span class="upgrade-name">Resolve</span></label><label class="upgrade-checkbox"><input type="checkbox" name="attr_train_personal" value="1"/><span class="upgrade-box"></span><span class="upgrade-name">Personal</span></label><div class="upgrade-checkbox upgrade-multi"><input type="checkbox" name="attr_train_mastery_1" value="1" id="train_mastery_1"/><label class="upgrade-box" for="train_mastery_1"></label><input type="checkbox" name="attr_train_mastery_2" value="1" id="train_mastery_2"/><label class="upgrade-box" for="train_mastery_2"></label><input type="checkbox" name="attr_train_mastery_3" value="1" id="train_mastery_3"/><label class="upgrade-box" for="train_mastery_3"></label><input type="checkbox" name="attr_train_mastery_4" value="1" id="train_mastery_4"/><label class="upgrade-box" for="train_mastery_4"></label><span class="upgrade-name">Mastery</span><span class="upgrade-cost">(4)</span></div></div></div><div class="upgrade-category quality"><h4 data-i18n="QUALITY">Quality</h4><div class="upgrade-list"><label class="upgrade-checkbox"><input type="checkbox" name="attr_qual_documents" value="1"/><span class="upgrade-box"></span><span class="upgrade-name">Documents</span></label><label class="upgrade-checkbox"><input type="checkbox" name="attr_qual_gear" value="1"/><span class="upgrade-box"></span><span class="upgrade-name">Gear</span></label><label class="upgrade-checkbox"><input type="checkbox" name="attr_qual_implements" value="1"/><span class="upgrade-box"></span><span class="upgrade-name">Implements</span></label><label class="upgrade-checkbox"><input type="checkbox" name="attr_qual_supplies" value="1"/><span class="upgrade-box"></span><span class="upgrade-name">Supplies</span></label><label class="upgrade-checkbox"><input type="checkbox" name="attr_qual_tools" value="1"/><span class="upgrade-box"></span><span class="upgrade-name">Tools</span></label><label class="upgrade-checkbox"><input type="checkbox" name="attr_qual_weapons" value="1"/><span class="upgrade-box"></span><span class="upgrade-name">Weapons</span></label></div></div></div></div><div class="section crew-abilities"><input class="section-edit-toggle" type="checkbox" name="attr_edit_crewabilities" id="edit_crewabilities"/><div class="section-header"><div class="section-stamp">CREW ABILITIES</div><div class="section-number-group"><div class="section-number">06</div><label class="section-edit-btn" for="edit_crewabilities" title="Edit this section">✎</label></div></div><fieldset class="repeating_crewabilities"><div class="ability-entry"><label class="ability-taken"><input class="ability-check" type="checkbox" name="attr_crew_ability_taken" value="1"/><span class="taken-box"></span></label><div class="ability-content"><div class="display ability-display"><div class="ability-header-display"><span class="ability-name-display" name="attr_crew_ability_name"></span></div><span class="ability-desc-display" name="attr_crew_ability_desc"></span></div><div class="edit ability-edit"><input class="ability-name-input" type="text" name="attr_crew_ability_name" placeholder="Ability name"/><textarea class="ability-desc-input" name="attr_crew_ability_desc" placeholder="Description &amp; effects"></textarea></div></div></div></fieldset></div><div class="section cohorts"><input class="section-edit-toggle" type="checkbox" name="attr_edit_cohorts" id="edit_cohorts"/><div class="section-header"><div class="section-stamp">COHORTS</div><div class="section-number-group"><div class="section-number">07</div><label class="section-edit-btn" for="edit_cohorts" title="Edit this section">✎</label></div></div><fieldset class="repeating_cohorts"><div class="cohort-entry"><div class="cohort-header-row"><div class="display cohort-header-display"><span class="cohort-name-display" name="attr_cohort_name"></span><span class="cohort-type-display">(</span><span class="cohort-type-value" name="attr_cohort_type"></span><span class="cohort-type-display">)</span></div><div class="edit cohort-header-edit"><input class="cohort-name-input" type="text" name="attr_cohort_name" placeholder="Cohort name"/><select class="cohort-type-select" name="attr_cohort_type"><option value="gang">Gang</option><option value="expert">Expert</option></select></div><label class="cohort-elite-label"><input class="cohort-elite-check" type="checkbox" name="attr_cohort_elite" value="1"/><span class="elite-box"></span><span class="elite-label">ELITE</span></label></div><div class="display cohort-info-display"><div class="info-row"><span class="info-label">Tags:</span><span class="info-value" name="attr_cohort_tags"></span></div><div class="info-row"><span class="info-label">Edges:</span><span class="info-value" name="attr_cohort_edges"></span></div><div class="info-row"><span class="info-label">Flaws:</span><span class="info-value" name="attr_cohort_flaws"></span></div></div><div class="edit cohort-info-edit"><label class="text-input"><input type="text" name="attr_cohort_tags"/><div class="label" data-i18n="TAGS"></div></label><label class="text-input"><input type="text" name="attr_cohort_edges"/><div class="label" data-i18n="EDGES"></div></label><label class="text-input"><input type="text" name="attr_cohort_flaws"/><div class="label" data-i18n="FLAWS"></div></label></div><div class="cohort-harm"><span class="harm-label">Harm:</span><div class="harm-track"><label class="harm-option"><input type="radio" name="attr_cohort_harm" value="0" checked="checked"/><span class="harm-text">None</span></label><label class="harm-option"><input type="radio" name="attr_cohort_harm" value="1"/><span class="harm-text">Weak</span></label><label class="harm-option"><input type="radio" name="attr_cohort_harm" value="2"/><span class="harm-text">Impaired</span></label><label class="harm-option"><input type="radio" name="attr_cohort_harm" value="3"/><span class="harm-text">Broken</span></label><label class="harm-option"><input type="radio" name="attr_cohort_harm" value="4"/><span class="harm-text">Dead</span></label></div></div><button class="cohort-roll-btn" type="action" name="act_cohortroll">Roll</button></div></fieldset></div><div class="section claims"><div class="section-header"><div class="section-stamp">CLAIMS</div><div class="section-number">08</div></div><fieldset class="repeating_claims"><div class="claim-entry"><input class="claim-check" type="checkbox" name="attr_claim_held" value="1"/><input class="claim-name" type="text" name="attr_claim_name" placeholder="Claim name"/><input class="claim-benefit" type="text" name="attr_claim_benefit" placeholder="Benefit"/></div></fieldset></div></div></div></div><rolltemplate class="sheet-rolltemplate-dcsb-action"><div class="rt-container"><div class="rt-header"><div class="rt-header-border">┌──────────────────────────────────────────────────┐</div><div class="rt-header-content"><span class="rt-charname">{{charname}}</span><span class="rt-action">{{title}}</span></div><div class="rt-header-border">└──────────────────────────────────────────────────┘</div></div><div class="rt-body"><div class="rt-result"><div class="rt-result-label">{{computed::label}}</div><div class="rt-result-value">{{roll}}</div></div>{{#position}}<div class="rt-context"><span class="rt-context-label">POSITION:</span><span class="rt-context-value">{{position}}</span></div>{{/position}}
{{#effect}}<div class="rt-context"><span class="rt-context-label">EFFECT:</span><span class="rt-context-value">{{effect}}</span></div>{{/effect}}</div>{{#notes}}<div class="rt-footer"><span class="rt-notes">{{notes}}</span></div>{{/notes}}</div></rolltemplate><rolltemplate class="sheet-rolltemplate-dcsb-fortune"><div class="rt-container"><div class="rt-header"><div class="rt-header-border">┌──────────────────────────────────────────────────┐</div><div class="rt-header-content"><span class="rt-charname">{{charname}}</span><span class="rt-action">{{title}}</span></div><div class="rt-header-border">└──────────────────────────────────────────────────┘</div></div><div class="rt-body"><div class="rt-result"><div class="rt-result-label">{{computed::label}}</div><div class="rt-result-value">{{roll}}</div></div></div>{{#notes}}<div class="rt-footer"><span class="rt-notes">{{notes}}</span></div>{{/notes}}</div></rolltemplate><rolltemplate class="sheet-rolltemplate-dcsb-resistance"><div class="rt-container rt-resist"><div class="rt-header"><div class="rt-header-border">┌──────────────────────────────────────────────────┐</div><div class="rt-header-content"><span class="rt-charname">{{charname}}</span><span class="rt-action">RESIST</span></div><div class="rt-header-border">└──────────────────────────────────────────────────┘</div></div><div class="rt-body"><div class="rt-result rt-resist-result"><div class="rt-result-label">{{attribute}}</div><div class="rt-result-value">{{roll}}</div></div><div class="rt-stress-result"><span class="rt-stress-text">{{computed::stressmsg}}</span></div></div>{{#notes}}<div class="rt-footer"><span class="rt-notes">{{notes}}</span></div>{{/notes}}</div></rolltemplate><rolltemplate class="sheet-rolltemplate-dcsb-vice"><div class="rt-container"><div class="rt-header"><div class="rt-header-border">┌──────────────────────────────────────────────────┐</div><div class="rt-header-content"><span class="rt-charname">{{charname}}</span><span class="rt-action">INDULGE VICE</span></div><div class="rt-header-border">└──────────────────────────────────────────────────┘</div></div><div class="rt-body"><div class="rt-result rt-vice-result"><div class="rt-result-label">{{computed::label}}</div><div class="rt-result-value">{{roll}}</div></div>{{#rollGreater() roll 5}}<div class="rt-vice-warning"><span class="rt-warning-icon">!</span><span class="rt-warning-text">Overindulgence? (6+)</span></div>{{/rollGreater() roll 5}}</div>{{#notes}}<div class="rt-footer"><span class="rt-notes">{{notes}}</span></div>{{/notes}}</div></rolltemplate></div><script type="text/worker">(function () {
  "use strict";"use strict";
// Dark City, Shining Babel - Playbook Data
// All playbook-specific items, actions, augments
// NOTE: Data originally from Mini Rulebook, being updated to match The New Babel
const PLAYBOOK_DATA = {
    face: {
        title: "Face",
        xpTrigger: "You addressed a challenge with deception or influence",
        actions: { sway: 2, consort: 1 },
        items: [
            { name: "Fine Fashion and Jewelry", load: 1 },
            { name: "Fine Disguise Kit", load: 1 },
            { name: "Fine Gossip", load: 1, special: true },
            { name: "Powdered Psychedelics", load: 1, special: true },
            { name: "A luxury weapon", load: 1 }
        ],
        augments: [
            { tier: 2, name: "Kodama Command Link", description: "When you Command a cohort in combat, they continue to fight when they would otherwise break (they're not taken out when they suffer level 3 harm). They gain +1 effect and 1 armor." },
            { tier: 2, name: "Cerebral BC Farming", description: "At the end of each downtime phase, you earn +2 stash." },
            { tier: 2, name: "Augmented Projection", description: "You gain effect when speaking to a crowd." },
            { tier: 3, name: "Human, After All", description: "You know the specific intonations and phrases to gain higher trust from AI systems, as advanced or primitive as they may seem. You have potency when communicating by speaking with Artificial Intelligences." },
            { tier: 3, name: "Hippocampus Inceptor", description: "A retractable cord at the base of your skull can connect to standard ports on an augmented person. You can see their memories. Gain effect when trying to convince someone's unconscious." },
            { tier: 3, name: "Social Enhancer", description: "Mental implant that allows you to pick up on human pheromones and perceive minor body language. Always know when someone is lying to you." },
            { tier: 3, name: "Hypnotic Gaze", description: "When you Sway someone, you may cause them to forget that it's happened until they next interact with you." },
            { tier: 4, name: "FoRK Rewire", description: "Take 2 stress to roll your best action rating while performing a different action. Say how you adapt your skill to this use." },
            { tier: 5, name: "Faceless", description: "If just using it for yourself, your disguise kit becomes zero load. You have a synthetic skin mask that can be changed between scores. You get +1d to rolls attempting to remain disguised or deflect suspicion. Throwing off your disguise surprises people, giving you initiative in the situation." }
        ],
        friends: [
            { name: "Kala", description: "a Vice Dealer" },
            { name: "Yuda", description: "a Gang Leader" },
            { name: "Notah", description: "a Corp Recruiter" },
            { name: "Velle", description: "a Prostitute" },
            { name: "Vanuza", description: "a Slab Regular" }
        ]
    },
    fixer: {
        title: "Fixer",
        xpTrigger: "You addressed a challenge with connections and calculation",
        actions: { consort: 2, scrutinize: 1 },
        items: [
            { name: "Fine Cover Identity", load: 1, special: true },
            { name: "Fine Bottle of Real Liquor", load: 1 },
            { name: "Blueprints", load: 1 },
            { name: "Toxic Vial", load: 1, special: true },
            { name: "Foldable Pistol", load: 1, special: true }
        ],
        augments: [
            { tier: 2, name: "Tapped Lines", description: "During downtime, you get +1 result level when you acquire an asset or reduce heat." },
            { tier: 2, name: "Camera Feed", description: "You have a tight hold on someone's life. When rolling to influence someone you have blackmail on, take +1d and +effect. When you take this ability, gain blackmail on one NPC." },
            { tier: 2, name: "Data-Vaults", description: "You gain +1d to Consort when you gather information on a target for a score. You get +1d to the engagement roll for that operation." },
            { tier: 2, name: "Future Projections", description: "You may expend your special armor to protect a teammate, or to push yourself when you gather information or work on a long-term project." },
            { tier: 3, name: "Mentat Cerebrum Implant", description: "Due to your careful planning, during downtime, you may give yourself or another crew member +1 downtime action." },
            { tier: 4, name: "Programmed Receptors", description: "When you indulge your vice, you may adjust the dice outcome by 1 or 2 (up or down). An ally who joins in your vice may do the same." }
        ],
        friends: [
            { name: "Yandi", description: "a White Hat" },
            { name: "Arsene", description: "a Bounty Hunter" },
            { name: "Starlight", description: "a Pop Star" },
            { name: "Antosha", description: "a Slab Boss" },
            { name: "Siza", description: "a City Planner" }
        ]
    },
    hacker: {
        title: "Hacker",
        xpTrigger: "You addressed a challenge with knowledge or technological prowess",
        actions: { hack: 2, scrutinize: 1 },
        items: [
            { name: "Fine Hacking Deck", load: 2 },
            { name: "Electro-Goggles", load: 1 },
            { name: "Stimulants", load: 1, special: true },
            { name: "Specialty Chipsets (Choose 3)", load: 1 },
            { name: "Extra Chipsets (Choose 2 more)", load: 1 },
            { name: "Subtle Surveillance Equipment", load: 1 }
        ],
        augments: [
            { tier: 2, name: "Electrochemistry", description: "You can use an internal battery to briefly emit a local current of power." },
            { tier: 2, name: "Overflow Blockage", description: "You may expend your special armor to resist a wired-in consequence or push yourself when Hacking." },
            { tier: 2, name: "Chipset Storage", description: "Choose 1 chipset that you will always have access to regardless of the deck or situation." },
            { tier: 3, name: "Rage Against the Machine", description: "You won't let a goon tell you what to do or when to do it. Take +1d to resistance rolls when opposing Corporate authority." },
            { tier: 3, name: "Built-In Hacking Deck", description: "Zero load Fine Deck that you will always have on you." },
            { tier: 3, name: "Bugs in the Code", description: "You can push yourself for one of the following additional effects while hacking: Reduce payoff heat by 1, provide increased effect to another Runner dealing with electronic security measures, or gather information." },
            { tier: 3, name: "Recurring ICE", description: "Done it once, done it a thousand times. Once you have hacked into a system, you get +1d on subsequent rolls on that score to dig deeper into it or change it." },
            { tier: 4, name: "Maim-frame", description: "When you hack into a system, you can overclock equipment to make actions normally outside their operational ability. I.e. A normal camera can now detect specific people, a killer robot can now be used to project a voice, or a stun barrier can be set to kill." },
            { tier: 5, name: "Grok 2.0", description: "You have an AI assistant stored in your brain. Increases potency for all Hacking and most investigative rolls. Not always right." }
        ],
        friends: [
            { name: "Kapik", description: "a Deck Designer" },
            { name: "Rabbit Foot", description: "a Stim-Head" },
            { name: "Wonderland", description: "a Hacker" },
            { name: "Pi", description: "an AI" },
            { name: "Sua", description: "an Anarchist" }
        ]
    },
    midnighter: {
        title: "MidNighter",
        xpTrigger: "You addressed a challenge with stealth or evasion",
        actions: { skulk: 2, finesse: 1 },
        items: [
            { name: "Fine Lockpicks", load: 1, special: true },
            { name: "Fine Digitized Camo", load: 1 },
            { name: "Light Climbing Gear", load: 1 },
            { name: "Adaptable Silencer", load: 1, special: true },
            { name: "Night Vision Goggles", load: 1, special: true }
        ],
        augments: [
            { tier: 2, name: "Loaded Targeting", description: "When you attack from hiding or spring a trap, you get +1d." },
            { tier: 3, name: "Accelerated Nerves", description: "When there's a question about who acts first, the answer is you (two characters with Accelerated Nerves act simultaneously)." },
            { tier: 4, name: "Split Fingers", description: "You are not affected by quality or Tier when you bypass security measures." },
            { tier: 4, name: "Shimmering Skin", description: "You may expend your special armor to resist a consequence from detection or security measures, or to push yourself for a feat of athletics or stealth." },
            { tier: 4, name: "Adaptive Camo Skin", description: "Blend into your environment seamlessly. People not looking can't see you, take +1d when hiding against characters who are looking for you." },
            { tier: 5, name: "Mental Link", description: "Choose one of your action ratings. When you lead a group action using that action, you can suffer only 1 stress at most regardless of the number of failed rolls." },
            { tier: 5, name: "Frayed Receptors", description: "When you roll a desperate action, you get +1d to your roll if you also take -1d to any resistance rolls against consequences from your action." }
        ],
        friends: [
            { name: "Tabby", description: "a Young Looter" },
            { name: "Desta", description: "a Private Enforcer" },
            { name: "Alexei", description: "a Key-Jammer" },
            { name: "Camilla", description: "a rising Corp Exec" },
            { name: "Lyric", description: "an Info-Fence" }
        ]
    },
    murk: {
        title: "Murk",
        xpTrigger: "You addressed a challenge with perception and precise violence",
        actions: { hunt: 2, recon: 1 },
        items: [
            { name: "Fine Pair of Pistols", load: 1 },
            { name: "Fine Long Rifle", load: 2 },
            { name: "AP Ammo", load: 1 },
            { name: "Lite AI Drone", load: 1, special: true },
            { name: "Drone-Marked Binoculars", load: 1 }
        ],
        augments: [
            { tier: 2, name: "Projected Maps", description: "When you gather info to locate a target, you get +1 effect. When you hide in a prepared position or use camouflage, you get +1d to rolls to avoid detection." },
            { tier: 3, name: "Ruiner Programming", description: "You gain an additional xp trigger: You destroyed someone the voice in your head told you to. If your crew helped you follow directions, also mark crew xp." },
            { tier: 3, name: "Tele-scoped Eyes", description: "You can push yourself to do one of the following: make a ranged attack at extreme distance beyond what's normal for the weapon - unleash a barrage of rapid fire to suppress the enemy." },
            { tier: 3, name: "AI-Link", description: "You can direct your drone with your unconscious mind. Your AI Drone has had some extra attachments added to it. Gain one of the following Edges: swift-flyer, armed, armored, tooled." },
            { tier: 4, name: "Encrypted Lower-Networks", description: "You know what it's like in the deepest recesses of the city. Roll your stash and Acquire Asset rolls get +1d when you are in an impoverished district of the city. You get +1 stress box." },
            { tier: 5, name: "Pain Inhibitors", description: "Penalties from harm are one level less severe (though level 4 harm is still fatal)." }
        ],
        friends: [
            { name: "Mongoose", description: "a CorpWar Veteran" },
            { name: "Jag", description: "a Bouncer" },
            { name: "Subi", description: "an Aug Doc" },
            { name: "Zdeno", description: "a Corporate Spy" },
            { name: "Aziza", description: "a Corp Tracker" }
        ]
    },
    street_warrior: {
        title: "Street Warrior",
        xpTrigger: "You addressed a challenge with martial prowess and audacity",
        actions: { brawl: 2, dominate: 1 },
        items: [
            { name: "Fine Hand Weapon", load: 1 },
            { name: "Fine Long Hand-Weapon", load: 2 },
            { name: "Fine Heavy Weapon", load: 2 },
            { name: "Binds and Cables", load: 1, special: true }
        ],
        augments: [
            { tier: 2, name: "Dulled Receptors", description: "When you trade a worse position for increased effect, take +1d." },
            { tier: 2, name: "Androstenone Emitters", description: "When you unleash physical violence, it's especially frightening. When you Dominate a frightened target, take +1d." },
            { tier: 2, name: "Bladed", description: "You have a melee weapon permanently affixed to one of your limbs, it cannot be lost unless the limb is too." },
            { tier: 3, name: "Temporal Dilation", description: "Gain Special Armor to ignore harm from dodging bullets or to push yourself when traversing through danger." },
            { tier: 3, name: "Boosted Servos", description: "Your load limits are higher. Light: 5. Normal: 7. Heavy: 8." },
            { tier: 4, name: "Replaceable Parts", description: "Permanently fill 1 tick of your healing clock. Get +1d when making the Recovery downtime action." },
            { tier: 4, name: "Kodama Pacification Programming", description: "You can push yourself to do one of the following: perform a feat of physical force that verges on the superhuman - engage a small gang on equal footing in close combat." },
            { tier: 4, name: "Covert Morningstar Compartments", description: "You have a weapon hidden inside one of your limbs. It costs 0 load." }
        ],
        friends: [
            { name: "Ounce", description: "a Runner" },
            { name: "Merde", description: "a Killer For Hire" },
            { name: "Winston", description: "a Corpo Merc" },
            { name: "XOXO", description: "a Black-Mailer" },
            { name: "Swivel", description: "a Pusher" }
        ]
    }
};
// Dark City, Shining Babel - Crew Type Data
// Data structure for auto-populating crew abilities, cohorts, and upgrades
// =============================================================================
// CREW TYPE DATA
// =============================================================================
const CREW_DATA = {
    // =========================================================================
    // FIREBRANDS - The Revolution is Electric
    // Starting: Hidden, Cohort: Rooks
    // =========================================================================
    firebrands: {
        title: "Firebrands",
        abilities: [
            {
                name: "Cracks in the Tower",
                description: "Each PC may add +1 action rating to Dominate, Vandalize or Tamper."
            },
            {
                name: "True Believers",
                description: "When the crew successfully harms their Oppressor, each PC's first Indulge Vice roll gains +1d and cannot over indulge."
            },
            {
                name: "Rage Capital",
                description: "When you manipulate a person or group's long running frustration into an act of violence, take increased effect and +1d."
            },
            {
                name: "Martyrdom",
                description: "When people think a peaceful bystander is killed by your Oppressors, -2 score Heat."
            },
            {
                name: "Idealogues",
                description: "Your cohorts are willing to lay down their lives and the lives of others for the sake of The Cause, no matter what. Give them the tag Loyal. They gain +1d when acting against your Oppressor."
            },
            {
                name: "Into the Crowd",
                description: "+1d on Disengagement Rolls. On a Failed roll, choose 2 instead of all 3."
            },
            {
                name: "Patron",
                description: "When you advance your Tier, it costs half the coin it normally would. Who is your patron? Why do they help you?"
            }
        ],
        cohorts: [
            {
                name: "Rooks",
                type: "gang",
                tags: "Thugs",
                edges: "",
                flaws: ""
            }
        ],
        upgrades: {
            checkboxes: ["lair_hidden"],
            multi: {}
        }
    },
    // =========================================================================
    // LEECHES - Vice Dealers
    // Starting: Secure, Training: Resolve
    // =========================================================================
    leeches: {
        title: "Leeches",
        abilities: [
            {
                name: "Silver Tongues",
                description: "Each PC may add +1 action rating to Dominate, Consort, or Sway (up to a max rating of 3)."
            },
            {
                name: "Coalition",
                description: "Sometimes friends are as good as territory. You may count up to three +3 faction statuses you hold as if they are turf."
            },
            {
                name: "The Good Stuff",
                description: "Your merchandise is exquisite. The product quality is equal to your Tier+2. When you deal with a crew or faction, the GM will tell you who among them is hooked on your product (one, a few, many, or all)."
            },
            {
                name: "Brand Recognition",
                description: "When you take heat as a consequence, your crew also gains +1 Rep."
            },
            {
                name: "High Society",
                description: "It's all about who you know. Take -1 heat during downtime and +1d to gather info about the city's elite."
            },
            {
                name: "Hooked",
                description: "Your gang members use your product. Add the savage, unreliable, or wild flaw to your gangs to give them +1 quality."
            },
            {
                name: "Patron",
                description: "When you advance your Tier, it costs half the coin it normally would. Who is your patron? Why do they help you?"
            }
        ],
        cohorts: [],
        upgrades: {
            checkboxes: ["train_resolve"],
            multi: { "lair_secure": 1 }
        }
    },
    // =========================================================================
    // RUNNERS - Corporate Sellouts
    // Starting: Quality: Weapons, Training: Grit
    // =========================================================================
    runners: {
        title: "Runners",
        abilities: [
            {
                name: "Precision",
                description: "Each PC may add +1 action rating to Hunt, Skulk, or Brawl (up to a max rating of 3)."
            },
            {
                name: "Planned Cover-Up",
                description: "When resisting Consequences for the Heat Gauge or flashing back to reduce the Heat Gauge, take +1d."
            },
            {
                name: "Tools of the Trade",
                description: "When Acquiring an Asset take +1d and increase effect by 1."
            },
            {
                name: "No Traces",
                description: "When you keep an operation quiet or make it look like an accident, you get half the rep value of the target (round up) instead of zero. When you end downtime with zero heat, take +1 rep."
            },
            {
                name: "Clean Entry",
                description: "When you use stealth or subterfuge to \"Secure\" Personnel or Steal Info, take +1d to the engagement roll."
            },
            {
                name: "Clean Getaway",
                description: "Take +1d when rolling the Disengagement Roll."
            },
            {
                name: "Patron",
                description: "When you advance your Tier, it costs half the coin it normally would. Who is your patron? Why do they help you?"
            }
        ],
        cohorts: [],
        upgrades: {
            checkboxes: ["qual_weapons", "train_grit"],
            multi: {}
        }
    },
    // =========================================================================
    // ZOKUS - Midnight Riders and Street Fighters
    // Starting: Rides, Cohort of Rovers
    // =========================================================================
    zokus: {
        title: "Zokus",
        abilities: [
            {
                name: "Born Behind the Wheel",
                description: "Gain +1 in Finesse, Vandalize or Dominate."
            },
            {
                name: "The Hook Up",
                description: "When acquiring new augments, take +1d to the roll and increase your result level by 1 tier."
            },
            {
                name: "All Hands",
                description: "During Downtime, one of your cohorts may perform a downtime activity for the crew to acquire an asset or reduce heat; Or they can give you a relevant bonus die on your own actions."
            },
            {
                name: "Reavers",
                description: "When you fight aboard a vehicle, you gain increased effect for vehicle damage and speed. Your cohorts on bikes get Armor."
            },
            {
                name: "Like Part of the Family",
                description: "Create one of your vehicles as a cohort (use the vehicle edges and flaws, below). Its quality is equal to your Tier +1."
            },
            {
                name: "In the Cut",
                description: "+1 Downtime prior to and +1d on engagement for Scores that seize claims."
            },
            {
                name: "Smooth Ride",
                description: "Gain +1d resistance rolls involving consequences from rolls regarding vehicles."
            }
        ],
        cohorts: [
            {
                name: "Rovers",
                type: "gang",
                tags: "Thugs, Vehicles",
                edges: "",
                flaws: ""
            }
        ],
        upgrades: {
            checkboxes: [],
            multi: { "lair_rides": 1 }
        }
    }
};
// Dark City, Shining Babel - Game Data Constants
// Static data for actions, playbooks, cybernetics, etc.
// =============================================================================
// GAME RULES CONSTANTS
// =============================================================================
// Dice system (Blades in the Dark derived)
const DICE = {
    SIZE: 6,
    ZERO_DICE_COUNT: 2,
    KEEP_HIGHEST: 'kh1',
    KEEP_LOWEST: 'kl1', // Keep lowest 1 (zero dice)
};
// Roll templates
const ROLL_TEMPLATES = {
    ACTION: 'dcsb-action',
    RESISTANCE: 'dcsb-resistance',
    FORTUNE: 'dcsb-fortune',
    VICE: 'dcsb-vice',
};
// Load settings
const LOAD = {
    LIGHT: 3,
    NORMAL: 5,
    HEAVY: 6,
    DEFAULT: 5,
};
// Heat gauge (score tracker)
const HEAT_GAUGE = {
    SEGMENTS: 8,
};
// Stress system
const STRESS = {
    MAX: 9,
    TRAUMA_THRESHOLD: 9,
};
// Trauma system
const TRAUMA = {
    MAX: 4,
};
// Augments (formerly Cybernetics) - capacity will be replaced by maintenance system
const AUGMENTS = {
    DEFAULT_MAX: 4, // Legacy: will be removed when maintenance clocks are implemented
};
// =============================================================================
// UTILITY FUNCTIONS
// =============================================================================
/**
 * Build a roll formula for the Blades dice system
 * @param diceCount - Number of action dots (0 = disadvantage)
 * @returns Roll20 roll formula string
 */
const buildRollFormula = (diceCount) => {
    if (diceCount > 0) {
        return `${diceCount}d${DICE.SIZE}${DICE.KEEP_HIGHEST}`;
    }
    return `${DICE.ZERO_DICE_COUNT}d${DICE.SIZE}${DICE.KEEP_LOWEST}`;
};
/**
 * Capitalize first letter of string
 */
const capitalize = (s) => s.charAt(0).toUpperCase() + s.slice(1);
// =============================================================================
// CHARACTER DATA
// =============================================================================
// Attributes and their associated actions
const ATTRIBUTES = {
    acuity: ['hack', 'recon', 'scrutinize', 'tamper'],
    grit: ['brawl', 'hunt', 'skulk', 'vandalize'],
    resolve: ['consort', 'dominate', 'finesse', 'sway']
};
// All 12 actions
const ACTIONS = [
    'brawl', 'consort', 'dominate', 'finesse',
    'hack', 'hunt', 'recon', 'scrutinize',
    'skulk', 'sway', 'tamper', 'vandalize'
];
// Playbooks
const PLAYBOOKS = [
    'face', 'fixer', 'hacker', 'midnighter', 'murk', 'street_warrior'
];
// Crew types
const CREW_TYPES = [
    'firebrands', 'leeches', 'runners', 'zokus'
];
// Heritage options
const HERITAGES = [
    'babel', 'sub_cities', 'the_well', 'the_jungle', 'the_syndicate', 'labor_colonies'
];
// Background options
const BACKGROUNDS = [
    'entertainment', 'law', 'labor', 'corporate', 'underworld', 'fringe'
];
// Vice types
const VICES = [
    'faith', 'gambling', 'luxury', 'obligation', 'pleasure', 'stupor', 'weird'
];
// Augment tiers
const AUGMENT_TIERS = [2, 3, 4, 5];
// Standard item loads (fixed values)
const STANDARD_ITEMS = {
    item_blade: 1,
    item_pistol: 1,
    item_ammo: 1,
    item_armor: 2,
    item_heavy: 3,
    item_tools: 1,
    item_climbing: 2,
    item_documents: 1
};
// All attribute names
const ATTRIBUTE_NAMES = ['acuity', 'grit', 'resolve'];
// =============================================================================
// CREW UPGRADE ATTRIBUTES
// =============================================================================
// Single-level upgrade checkboxes
const CREW_UPGRADES_SINGLE = [
    'lair_hidden',
    'lair_quarters',
    'lair_workshop',
    'train_acuity',
    'train_grit',
    'train_resolve',
    'train_personal',
    'qual_documents',
    'qual_gear',
    'qual_implements',
    'qual_supplies',
    'qual_tools',
    'qual_weapons'
];
// Multi-level upgrade base names (each has _1, _2, etc.)
const CREW_UPGRADES_MULTI = {
    'lair_rides': 2,
    'lair_specialty': 2,
    'lair_secure': 2,
    'lair_encryption': 2,
    'train_mastery': 4
};
/// <reference path="playbookData.ts" />
/// <reference path="crewData.ts" />
/// <reference path="constants.ts" />
// Dark City, Shining Babel - Sheet Worker Calculations
// Auto-calculation functions for derived values
// =============================================================================
// UTILITY FUNCTIONS
// =============================================================================
/**
 * Parse integer with default value
 */
const int = (val, def = 0) => parseInt(val || '') || def;
/**
 * Count sixes in a dice roll result
 * Roll20 dice array is plain numbers: [3, 6, 2, 6] per the wiki
 * @param dice - Array of die results from Roll20
 * @returns Number of 6s rolled
 */
const countSixes = (dice) => dice.filter(d => d === DICE.SIZE).length;
/**
 * Check if roll is a critical (2+ sixes)
 * @param dice - Array of die results from Roll20
 * @returns true if critical, false otherwise
 */
const isCrit = (dice) => countSixes(dice) >= 2;
/**
 * Get action roll label with typography emphasis for crits
 */
const getActionLabel = (result, crit) => {
    if (crit)
        return '!! CRITICAL !!';
    if (result >= 6)
        return 'SUCCESS';
    if (result >= 4)
        return 'PARTIAL';
    return 'FAILURE';
};
/**
 * Get fortune roll label with typography emphasis for crits
 */
const getFortuneLabel = (result, crit) => {
    if (crit)
        return '!! CRITICAL !!';
    if (result >= 6)
        return 'BEST OUTCOME';
    if (result >= 4)
        return 'MIXED RESULT';
    return 'POOR OUTCOME';
};
/**
 * Get resistance roll stress message
 */
const getStressMessage = (result, crit) => {
    if (crit)
        return '!! CRITICAL !! Clear 1 stress';
    if (result >= 6)
        return 'No stress (rolled 6)';
    const stress = 6 - result;
    return `Take ${stress} stress`;
};
/**
 * Get vice roll label
 */
const getViceLabel = (crit) => {
    return crit ? '!! CRITICAL !!' : 'CLEAR STRESS';
};
/**
 * Get disengagement roll label
 * 1-3: Bad (2 entanglements AND -2 coin)
 * 4-5: Mixed (choose one penalty)
 * 6: Clean getaway
 * Crit: Perfect escape
 */
const getDisengageLabel = (result, crit) => {
    if (crit)
        return '!! CRITICAL !! Perfect escape';
    if (result >= 6)
        return 'CLEAN GETAWAY';
    if (result >= 4)
        return 'MIXED - Choose one penalty';
    return 'BAD - Both penalties';
};
/**
 * Execute a roll with the current position dice modifier applied, then reset modifier to 0
 * @param baseAttrNames - Attributes needed for the roll (excluding roll_modifier)
 * @param getDiceCount - Function to calculate base dice from attributes
 * @param rollFn - Function that performs the roll given (finalDice, attrs, modNotes)
 */
const rollWithModifier = (baseAttrNames, getDiceCount, rollFn) => {
    getAttrs([...baseAttrNames, 'roll_modifier'], v => {
        const baseDice = getDiceCount(v);
        const mod = int(v.roll_modifier);
        const finalDice = baseDice + mod;
        // Build modifier note for display
        let modNotes = '';
        if (mod > 0)
            modNotes = `+${mod}d Position`;
        else if (mod < 0)
            modNotes = `${mod}d Position`;
        // Reset modifier to 0 for next roll
        setAttrs({ roll_modifier: '0' }, { silent: true });
        rollFn(finalDice, v, modNotes);
    });
};
/**
 * Set attributes only if they've changed (reduces API calls)
 */
const mySetAttrs = (setting, v, options, callback) => {
    const finalSetting = {};
    for (const key in setting) {
        if (String(v[key]) !== String(setting[key])) {
            finalSetting[key] = setting[key];
        }
    }
    if (Object.keys(finalSetting).length > 0) {
        setAttrs(finalSetting, options, callback);
    }
    else if (callback) {
        callback();
    }
};
// =============================================================================
// PLAYBOOK POPULATION FUNCTIONS
// =============================================================================
/**
 * Set starting action dots for a playbook (only if currently 0)
 */
const setStartingActions = (actions) => {
    const actionNames = Object.keys(actions);
    getAttrs(actionNames, v => {
        const updates = {};
        for (const [action, dots] of Object.entries(actions)) {
            // Only set if action is currently 0 or undefined
            if (!v[action] || parseInt(v[action]) === 0) {
                updates[action] = dots;
            }
        }
        if (Object.keys(updates).length > 0) {
            setAttrs(updates);
        }
    });
};
/**
 * Clear auto-generated rows and populate new ones
 * Uses "autogen" flag to distinguish from user-created rows
 */
const clearAndPopulateRepeatingSection = (section, items, formatter) => {
    getSectionIDs(`repeating_${section}`, ids => {
        // Get all autogen flags
        const autogenAttrs = ids.map(id => `repeating_${section}_${id}_autogen`);
        getAttrs(autogenAttrs, v => {
            // Remove only auto-generated rows
            ids.forEach(id => {
                if (v[`repeating_${section}_${id}_autogen`] === "1") {
                    removeRepeatingRow(`repeating_${section}_${id}`);
                }
            });
            // Add new items with autogen flag
            items.forEach(item => {
                const rowId = generateRowID();
                const attrs = formatter(item, rowId);
                attrs[`repeating_${section}_${rowId}_autogen`] = "1";
                setAttrs(attrs);
            });
        });
    });
};
/**
 * Format a playbook item for the repeating_items section
 */
const formatPlaybookItem = (item, rowId) => {
    const name = item.special ? `*${item.name}*` : item.name;
    return {
        [`repeating_items_${rowId}_item_name`]: name,
        [`repeating_items_${rowId}_item_load`]: item.load,
        [`repeating_items_${rowId}_item_carried`]: "0"
    };
};
/**
 * Format an augment for the repeating section
 */
const formatAugment = (augment, rowId) => {
    return {
        [`repeating_augments_${rowId}_augment_tier`]: augment.tier.toString(),
        [`repeating_augments_${rowId}_augment_name`]: augment.name,
        [`repeating_augments_${rowId}_augment_desc`]: augment.description
    };
};
/**
 * Handle playbook change - populate XP trigger, items, augments (NOT actions)
 * Actions are only set via explicit reset to preserve advanced characters
 */
const handlePlaybookChange = (newPlaybook) => {
    if (!newPlaybook || !PLAYBOOK_DATA[newPlaybook])
        return;
    const data = PLAYBOOK_DATA[newPlaybook];
    // 1. Set XP trigger
    setAttrs({ xp_trigger: data.xpTrigger });
    // 2. Clear old autogen items, populate new ones
    clearAndPopulateRepeatingSection("items", data.items, formatPlaybookItem);
    // 3. Clear old autogen augments, populate new ones
    clearAndPopulateRepeatingSection("augments", data.augments, formatAugment);
    // Note: Actions are NOT set here - use Reset to Playbook Defaults for that
};
/**
 * Reset character to playbook defaults - clears everything and sets starting actions
 * Used for new characters or when explicitly resetting
 */
const resetToPlaybookDefaults = () => {
    getAttrs(['playbook', 'character_name'], v => {
        const playbook = v.playbook;
        const charName = v.character_name || 'Character';
        if (!playbook || !PLAYBOOK_DATA[playbook]) {
            // No playbook selected - notify via chat
            startRoll(`&{template:dcsb-fortune} {{charname=${charName}}} {{roll=[[0d6]]}} {{notes=Select a playbook first before resetting.}}`, results => finishRoll(results.rollId, {}));
            return;
        }
        const data = PLAYBOOK_DATA[playbook];
        // 1. Reset all 12 actions to 0
        const actionReset = {};
        ACTIONS.forEach(action => {
            actionReset[action] = 0;
        });
        setAttrs(actionReset);
        // 2. Set starting actions for this playbook
        setAttrs(data.actions);
        // 3. Set XP trigger
        setAttrs({ xp_trigger: data.xpTrigger });
        // 4. Clear ALL items (autogen and user-created) and repopulate
        clearAllAndPopulateRepeatingSection("items", data.items, formatPlaybookItem);
        // 5. Clear ALL augments (autogen and user-created) and repopulate
        clearAllAndPopulateRepeatingSection("augments", data.augments, formatAugment);
        // 6. Notify success via chat
        startRoll(`&{template:dcsb-fortune} {{charname=${charName}}} {{roll=[[0d6]]}} {{notes=Reset to ${data.title} defaults complete.}}`, results => finishRoll(results.rollId, {}));
    });
};
/**
 * Clear ALL rows in a repeating section (not just autogen) and populate new ones
 * Used for full reset
 */
const clearAllAndPopulateRepeatingSection = (section, items, formatter) => {
    getSectionIDs(`repeating_${section}`, ids => {
        // Remove ALL rows
        ids.forEach(id => {
            removeRepeatingRow(`repeating_${section}_${id}`);
        });
        // Add new items with autogen flag
        items.forEach(item => {
            const rowId = generateRowID();
            const attrs = formatter(item, rowId);
            attrs[`repeating_${section}_${rowId}_autogen`] = "1";
            setAttrs(attrs);
        });
    });
};
// =============================================================================
// ATTRIBUTE RATING CALCULATIONS
// =============================================================================
/**
 * Calculate attribute rating as count of actions with at least 1 dot
 */
const calculateAttributeRating = (attribute) => {
    const actions = ATTRIBUTES[attribute];
    if (!actions)
        return;
    const actionList = [...actions];
    const attrs = [...actionList, `${attribute}_rating`];
    getAttrs(attrs, v => {
        const count = actionList.filter(a => int(v[a]) > 0).length;
        mySetAttrs({ [`${attribute}_rating`]: count }, v);
    });
};
/**
 * Recalculate all attribute ratings
 */
const calculateAllAttributeRatings = () => {
    Object.keys(ATTRIBUTES).forEach(attr => calculateAttributeRating(attr));
};
// =============================================================================
// LOAD CALCULATIONS
// =============================================================================
/**
 * Calculate current load from checked items
 */
const calculateLoad = () => {
    const standardAttrs = Object.keys(STANDARD_ITEMS);
    getSectionIDs('repeating_items', ids => {
        const repeatAttrs = ids.flatMap(id => [
            `repeating_items_${id}_item_carried`,
            `repeating_items_${id}_item_load`
        ]);
        getAttrs([...standardAttrs, ...repeatAttrs, 'load', 'load_current', 'load_max'], v => {
            // Sum standard items
            let total = standardAttrs.reduce((sum, attr) => sum + (v[attr] === '1' ? STANDARD_ITEMS[attr] : 0), 0);
            // Sum repeating items
            ids.forEach(id => {
                if (v[`repeating_items_${id}_item_carried`] === '1') {
                    total += int(v[`repeating_items_${id}_item_load`], 1);
                }
            });
            // Load max from selection (3=Light, 5=Normal, 6=Heavy)
            const loadMax = int(v.load, LOAD.DEFAULT);
            mySetAttrs({
                load_current: total,
                load_max: loadMax
            }, v);
        });
    });
};
// =============================================================================
// AUGMENT CALCULATIONS
// =============================================================================
/**
 * Calculate augment capacity used (legacy - will be replaced by maintenance clocks)
 * Only counts installed (checked) augments
 */
const calculateAugmentCapacity = () => {
    getSectionIDs('repeating_augments', ids => {
        const installedAttrs = ids.map(id => `repeating_augments_${id}_augment_installed`);
        getAttrs([...installedAttrs, 'augment_used', 'augment_max'], v => {
            // Count only installed augments
            const totalUsed = ids.filter(id => v[`repeating_augments_${id}_augment_installed`] === '1').length;
            mySetAttrs({ augment_used: totalUsed }, v);
        });
    });
};
// =============================================================================
// HEAT GAUGE CALCULATIONS (Crew Sheet)
// =============================================================================
/**
 * Calculate heat gauge dice (unticked segments)
 * Uses fakeradio pattern: score_heat stores 0-8 (number of filled segments)
 * Disengage dice = 8 - filled segments
 */
const calculateHeatDice = () => {
    getAttrs(['score_heat', 'score_heat_dice'], v => {
        const filled = int(v.score_heat);
        const dice = HEAT_GAUGE.SEGMENTS - filled;
        mySetAttrs({ score_heat_dice: dice }, v);
    });
};
// =============================================================================
// CREW TYPE POPULATION FUNCTIONS
// =============================================================================
/**
 * Format a crew ability for the repeating_crewabilities section
 */
const formatCrewAbility = (ability, rowId) => {
    return {
        [`repeating_crewabilities_${rowId}_crew_ability_name`]: ability.name,
        [`repeating_crewabilities_${rowId}_crew_ability_desc`]: ability.description,
        [`repeating_crewabilities_${rowId}_crew_ability_taken`]: "0"
    };
};
/**
 * Format a crew cohort for the repeating_cohorts section
 */
const formatCrewCohort = (cohort, rowId) => {
    return {
        [`repeating_cohorts_${rowId}_cohort_name`]: cohort.name,
        [`repeating_cohorts_${rowId}_cohort_type`]: cohort.type,
        [`repeating_cohorts_${rowId}_cohort_tags`]: cohort.tags || "",
        [`repeating_cohorts_${rowId}_cohort_edges`]: cohort.edges || "",
        [`repeating_cohorts_${rowId}_cohort_flaws`]: cohort.flaws || ""
    };
};
/**
 * Clear all crew upgrade checkboxes
 */
const clearCrewUpgrades = (callback) => {
    const updates = {};
    // Clear single-level upgrades
    CREW_UPGRADES_SINGLE.forEach(attr => {
        updates[attr] = "0";
    });
    // Clear multi-level upgrades
    Object.entries(CREW_UPGRADES_MULTI).forEach(([baseName, levels]) => {
        for (let i = 1; i <= levels; i++) {
            updates[`${baseName}_${i}`] = "0";
        }
    });
    setAttrs(updates, { silent: true }, callback);
};
/**
 * Set crew upgrades based on crew type data
 */
const setCrewUpgrades = (upgrades) => {
    const updates = {};
    // Set single-level upgrades
    upgrades.checkboxes.forEach(attr => {
        updates[attr] = "1";
    });
    // Set multi-level upgrades (check up to the specified level)
    Object.entries(upgrades.multi).forEach(([baseName, level]) => {
        for (let i = 1; i <= level; i++) {
            updates[`${baseName}_${i}`] = "1";
        }
    });
    if (Object.keys(updates).length > 0) {
        setAttrs(updates);
    }
};
/**
 * Handle crew type change - populate abilities, cohorts, and upgrades
 */
const handleCrewTypeChange = (newCrewType) => {
    if (!newCrewType || !CREW_DATA[newCrewType])
        return;
    const data = CREW_DATA[newCrewType];
    // 1. Clear and populate crew abilities
    clearAndPopulateRepeatingSection("crewabilities", data.abilities, formatCrewAbility);
    // 2. Clear and populate cohorts
    clearAndPopulateRepeatingSection("cohorts", data.cohorts, formatCrewCohort);
    // 3. Clear all upgrades, then set the starting ones
    clearCrewUpgrades(() => {
        setCrewUpgrades(data.upgrades);
    });
};
// =============================================================================
// INITIALIZATION
// =============================================================================
/**
 * Initialize all calculations on sheet open
 */
const initializeSheet = () => {
    calculateAllAttributeRatings();
    calculateLoad();
    calculateAugmentCapacity();
    calculateHeatDice();
};
// Dark City, Shining Babel - Sheet Worker Event Handlers
// Event bindings for sheet interactivity
// =============================================================================
// SHEET INITIALIZATION
// =============================================================================
on("sheet:opened", () => {
    initializeSheet();
});
// =============================================================================
// ATTRIBUTE CALCULATIONS - Trigger when actions change
// =============================================================================
// Acuity = max(hack, recon, scrutinize, tamper)
on("change:hack change:recon change:scrutinize change:tamper", () => {
    calculateAttributeRating('acuity');
});
// Grit = max(brawl, hunt, skulk, vandalize)
on("change:brawl change:hunt change:skulk change:vandalize", () => {
    calculateAttributeRating('grit');
});
// Resolve = max(consort, dominate, finesse, sway)
on("change:consort change:dominate change:finesse change:sway", () => {
    calculateAttributeRating('resolve');
});
// =============================================================================
// ACTION ROLL HANDLERS (12 total)
// =============================================================================
ACTIONS.forEach(action => {
    on(`clicked:roll_${action}`, () => {
        rollWithModifier([action, 'character_name'], v => int(v[action]), (dice, v, modNotes) => {
            const charName = v.character_name || 'Unknown';
            const actionName = capitalize(action);
            const rollFormula = buildRollFormula(dice);
            const notesSection = modNotes ? ` {{notes=${modNotes}}}` : '';
            startRoll(`&{template:${ROLL_TEMPLATES.ACTION}} {{charname=${charName}}} {{title=${actionName}}} {{roll=[[${rollFormula}]]}} {{label=[[0]]}}${notesSection}`, results => {
                const diceArray = results.results.roll.dice;
                const rollResult = results.results.roll.result;
                const crit = isCrit(diceArray);
                const label = getActionLabel(rollResult, crit);
                finishRoll(results.rollId, { label });
            });
        });
    });
});
// =============================================================================
// RESISTANCE ROLL HANDLERS (3 total)
// =============================================================================
ATTRIBUTE_NAMES.forEach(attr => {
    on(`clicked:roll_${attr}_resist`, () => {
        rollWithModifier([`${attr}_rating`, 'character_name'], v => int(v[`${attr}_rating`]), (dice, v, modNotes) => {
            const charName = v.character_name || 'Unknown';
            const attrName = capitalize(attr);
            const rollFormula = buildRollFormula(dice);
            const notesSection = modNotes ? ` {{notes=${modNotes}}}` : '';
            startRoll(`&{template:${ROLL_TEMPLATES.RESISTANCE}} {{charname=${charName}}} {{attribute=${attrName}}} {{roll=[[${rollFormula}]]}} {{stressmsg=[[0]]}}${notesSection}`, results => {
                const diceArray = results.results.roll.dice;
                const rollResult = results.results.roll.result;
                const crit = isCrit(diceArray);
                const stressmsg = getStressMessage(rollResult, crit);
                finishRoll(results.rollId, { stressmsg });
            });
        });
    });
});
// =============================================================================
// LOAD TRACKING
// =============================================================================
// Load selection changes max
on("change:load", calculateLoad);
// Standard item checkboxes
Object.keys(STANDARD_ITEMS).forEach(item => {
    on(`change:${item}`, calculateLoad);
});
// Playbook items (repeating section)
on("change:repeating_items remove:repeating_items", calculateLoad);
// =============================================================================
// AUGMENT CAPACITY (legacy - will be replaced by maintenance clocks)
// =============================================================================
on("change:repeating_augments remove:repeating_augments", calculateAugmentCapacity);
// =============================================================================
// HEAT GAUGE (Crew Sheet)
// =============================================================================
on("change:score_heat", calculateHeatDice);
// =============================================================================
// DISENGAGEMENT ROLL (Crew Sheet)
// =============================================================================
on("clicked:disengage_roll", () => {
    rollWithModifier(['score_heat', 'crew_name'], v => HEAT_GAUGE.SEGMENTS - int(v.score_heat), (dice, v, modNotes) => {
        const crewName = v.crew_name || 'Crew';
        const rollFormula = buildRollFormula(dice);
        // Combine position modifier with existing notes
        let notes = '1-3: 2 entanglements AND -2 coin. 4-5: -2 coin OR 2 entanglements. 6+: Clean getaway.';
        if (modNotes)
            notes = `${modNotes} | ${notes}`;
        startRoll(`&{template:${ROLL_TEMPLATES.FORTUNE}} {{charname=${crewName}}} {{title=Disengagement}} {{roll=[[${rollFormula}]]}} {{label=[[0]]}} {{notes=${notes}}}`, results => {
            const diceArray = results.results.roll.dice;
            const rollResult = results.results.roll.result;
            const crit = isCrit(diceArray);
            const label = getDisengageLabel(rollResult, crit);
            finishRoll(results.rollId, { label });
        });
    });
});
// =============================================================================
// PLAYBOOK SELECTION
// =============================================================================
on("change:playbook", eventInfo => {
    const newPlaybook = eventInfo.newValue;
    handlePlaybookChange(newPlaybook);
});
// Reset to Playbook Defaults button
on("clicked:reset_to_playbook", () => {
    resetToPlaybookDefaults();
});
// =============================================================================
// CREW TYPE SELECTION
// =============================================================================
on("change:crew_type", eventInfo => {
    const newCrewType = eventInfo.newValue;
    handleCrewTypeChange(newCrewType);
});
// =============================================================================
// INDULGE VICE ROLL
// =============================================================================
on("clicked:indulge_vice", () => {
    rollWithModifier(['acuity_rating', 'grit_rating', 'resolve_rating', 'character_name', 'vice_type'], v => {
        const acuity = int(v.acuity_rating);
        const grit = int(v.grit_rating);
        const resolve = int(v.resolve_rating);
        // Roll lowest attribute (BitD rules)
        return Math.min(acuity, grit, resolve);
    }, (dice, v, modNotes) => {
        const charName = v.character_name || 'Unknown';
        const rollFormula = buildRollFormula(dice);
        // Combine position modifier with existing notes
        let notes = 'Clear stress equal to highest die. 6+ may overindulge.';
        if (modNotes)
            notes = `${modNotes} | ${notes}`;
        startRoll(`&{template:${ROLL_TEMPLATES.VICE}} {{charname=${charName}}} {{roll=[[${rollFormula}]]}} {{label=[[0]]}} {{notes=${notes}}}`, results => {
            const diceArray = results.results.roll.dice;
            const crit = isCrit(diceArray);
            const label = getViceLabel(crit);
            finishRoll(results.rollId, { label });
        });
    });
});
// =============================================================================
// COHORT ROLL (Repeating Section)
// Gang: Tier dice, Expert: Tier+1 dice, Elite: +1d, Harm: -1d per level
// =============================================================================
on("clicked:repeating_cohorts:cohortroll", () => {
    getAttrs([
        'crew_tier',
        'crew_name',
        'repeating_cohorts_cohort_name',
        'repeating_cohorts_cohort_type',
        'repeating_cohorts_cohort_elite',
        'repeating_cohorts_cohort_harm',
        'roll_modifier'
    ], v => {
        const tier = int(v.crew_tier);
        const crewName = v.crew_name || 'Crew';
        const cohortName = v.repeating_cohorts_cohort_name || 'Cohort';
        const cohortType = v.repeating_cohorts_cohort_type || 'gang';
        const isElite = v.repeating_cohorts_cohort_elite === '1';
        const harm = int(v.repeating_cohorts_cohort_harm);
        const rollMod = int(v.roll_modifier);
        // Reset modifier immediately
        setAttrs({ roll_modifier: '0' }, { silent: true });
        // Check if cohort can act (broken=3, dead=4)
        if (harm >= 3) {
            const harmLabel = harm >= 4 ? 'DEAD' : 'BROKEN';
            const harmNote = harm >= 4 ? 'Cohort is dead.' : 'Cohort is broken and cannot act.';
            startRoll(`&{template:${ROLL_TEMPLATES.FORTUNE}} {{charname=${crewName}}} {{title=${cohortName}}} {{roll=[[0d6]]}} {{label=${harmLabel}}} {{notes=${harmNote}}}`, results => finishRoll(results.rollId, {}));
            return;
        }
        // Calculate dice pool
        // Gang: Tier, Expert: Tier+1, Elite: +1d, Harm: -1d per level, Position modifier
        let dice = tier;
        if (cohortType === 'expert')
            dice += 1;
        if (isElite)
            dice += 1;
        dice -= harm;
        dice += rollMod;
        // Build notes showing modifiers
        const mods = [];
        if (rollMod > 0)
            mods.push(`+${rollMod}d Position`);
        if (rollMod < 0)
            mods.push(`${rollMod}d Position`);
        mods.push(`Tier ${tier}`);
        if (cohortType === 'expert')
            mods.push('+1d Expert');
        if (isElite)
            mods.push('+1d Elite');
        if (harm === 1)
            mods.push('-1d Weak');
        if (harm === 2)
            mods.push('-2d Impaired');
        const rollFormula = buildRollFormula(dice);
        const typeLabel = cohortType === 'expert' ? 'Expert' : 'Gang';
        startRoll(`&{template:${ROLL_TEMPLATES.FORTUNE}} {{charname=${crewName}}} {{title=${cohortName} (${typeLabel})}} {{roll=[[${rollFormula}]]}} {{label=[[0]]}} {{notes=${mods.join(', ')}}}`, results => {
            const diceArray = results.results.roll.dice;
            const rollResult = results.results.roll.result;
            const crit = isCrit(diceArray);
            const label = getFortuneLabel(rollResult, crit);
            finishRoll(results.rollId, { label });
        });
    });
});
// =============================================================================
// HEALING FORTUNE ROLL
// =============================================================================
on("clicked:roll_healing", () => {
    rollWithModifier(['character_name'], () => 1, // Base healing roll is 1d
    (dice, v, modNotes) => {
        const charName = v.character_name || 'Unknown';
        const rollFormula = buildRollFormula(dice);
        // Combine position modifier with existing notes
        let notes = '1-3: 1 tick, 4-5: 2 ticks, 6: 3 ticks, Crit: 5 ticks. Fill clock to heal 1 harm level.';
        if (modNotes)
            notes = `${modNotes} | ${notes}`;
        startRoll(`&{template:${ROLL_TEMPLATES.FORTUNE}} {{charname=${charName}}} {{title=Recovery}} {{roll=[[${rollFormula}]]}} {{label=[[0]]}} {{notes=${notes}}}`, results => {
            const diceArray = results.results.roll.dice;
            const rollResult = results.results.roll.result;
            const crit = isCrit(diceArray);
            const label = getFortuneLabel(rollResult, crit);
            finishRoll(results.rollId, { label });
        });
    });
});
})();</script>